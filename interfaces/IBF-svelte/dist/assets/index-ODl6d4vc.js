var un=Object.defineProperty;var dn=(o,e,t)=>e in o?un(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var nt=(o,e,t)=>dn(o,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const r of a.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&n(r)}).observe(document,{childList:!0,subtree:!0});function t(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(s){if(s.ep)return;s.ep=!0;const a=t(s);fetch(s.href,a)}})();function U(){}function ln(o){return o()}function Lt(){return Object.create(null)}function se(o){o.forEach(ln)}function ut(o){return typeof o=="function"}function Me(o,e){return o!=o?e==e:o!==e||o&&typeof o=="object"||typeof o=="function"}function fn(o){return Object.keys(o).length===0}function dt(o,...e){if(o==null){for(const n of e)n(void 0);return U}const t=o.subscribe(...e);return t.unsubscribe?()=>t.unsubscribe():t}function ye(o){let e;return dt(o,t=>e=t)(),e}function Ke(o,e,t){o.$$.on_destroy.push(dt(e,t))}const pn=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function d(o,e){o.appendChild(e)}function I(o,e,t){o.insertBefore(e,t||null)}function C(o){o.parentNode&&o.parentNode.removeChild(o)}function ft(o,e){for(let t=0;t<o.length;t+=1)o[t]&&o[t].d(e)}function p(o){return document.createElement(o)}function oe(o){return document.createElementNS("http://www.w3.org/2000/svg",o)}function x(o){return document.createTextNode(o)}function w(){return x(" ")}function pt(){return x("")}function O(o,e,t,n){return o.addEventListener(e,t,n),()=>o.removeEventListener(e,t,n)}function mn(o){return function(e){return e.preventDefault(),o.call(this,e)}}function Tt(o){return function(e){return e.stopPropagation(),o.call(this,e)}}function i(o,e,t){t==null?o.removeAttribute(e):o.getAttribute(e)!==t&&o.setAttribute(e,t)}function gn(o){return Array.from(o.childNodes)}function ee(o,e){e=""+e,o.data!==e&&(o.data=e)}function Ne(o,e){o.value=e??""}function we(o,e,t){o.classList.toggle(e,!!t)}function hn(o,e,{bubbles:t=!1,cancelable:n=!1}={}){return new CustomEvent(o,{detail:e,bubbles:t,cancelable:n})}let Oe;function Re(o){Oe=o}function mt(){if(!Oe)throw new Error("Function called outside component initialization");return Oe}function gt(o){mt().$$.on_mount.push(o)}function vn(o){mt().$$.on_destroy.push(o)}function ht(){const o=mt();return(e,t,{cancelable:n=!1}={})=>{const s=o.$$.callbacks[e];if(s){const a=hn(e,t,{cancelable:n});return s.slice().forEach(r=>{r.call(o,a)}),!a.defaultPrevented}return!0}}function St(o,e){const t=o.$$.callbacks[e.type];t&&t.slice().forEach(n=>n.call(this,e))}const De=[],rt=[];let Be=[];const Dt=[],yn=Promise.resolve();let lt=!1;function _n(){lt||(lt=!0,yn.then(cn))}function it(o){Be.push(o)}const ot=new Set;let Te=0;function cn(){if(Te!==0)return;const o=Oe;do{try{for(;Te<De.length;){const e=De[Te];Te++,Re(e),bn(e.$$)}}catch(e){throw De.length=0,Te=0,e}for(Re(null),De.length=0,Te=0;rt.length;)rt.pop()();for(let e=0;e<Be.length;e+=1){const t=Be[e];ot.has(t)||(ot.add(t),t())}Be.length=0}while(De.length);for(;Dt.length;)Dt.pop()();lt=!1,ot.clear(),Re(o)}function bn(o){if(o.fragment!==null){o.update(),se(o.before_update);const e=o.dirty;o.dirty=[-1],o.fragment&&o.fragment.p(o.ctx,e),o.after_update.forEach(it)}}function wn(o){const e=[],t=[];Be.forEach(n=>o.indexOf(n)===-1?e.push(n):t.push(n)),t.forEach(n=>n()),Be=e}const Je=new Set;let $e;function Ye(){$e={r:0,c:[],p:$e}}function Qe(){$e.r||se($e.c),$e=$e.p}function K(o,e){o&&o.i&&(Je.delete(o),o.i(e))}function de(o,e,t,n){if(o&&o.o){if(Je.has(o))return;Je.add(o),$e.c.push(()=>{Je.delete(o),n&&(t&&o.d(1),n())}),o.o(e)}else n&&n()}function ke(o){return(o==null?void 0:o.length)!==void 0?o:Array.from(o)}function kn(o,e){o.d(1),e.delete(o.key)}function An(o,e,t,n,s,a,r,c,l,u,f,m){let h=o.length,v=a.length,_=h;const $={};for(;_--;)$[o[_].key]=_;const g=[],k=new Map,b=new Map,E=[];for(_=v;_--;){const S=m(s,a,_),D=t(S);let N=r.get(D);N?E.push(()=>N.p(S,e)):(N=u(D,S),N.c()),k.set(D,g[_]=N),D in $&&b.set(D,Math.abs(_-$[D]))}const L=new Set,z=new Set;function j(S){K(S,1),S.m(c,f),r.set(S.key,S),f=S.first,v--}for(;h&&v;){const S=g[v-1],D=o[h-1],N=S.key,Y=D.key;S===D?(f=S.first,h--,v--):k.has(Y)?!r.has(N)||L.has(N)?j(S):z.has(Y)?h--:b.get(N)>b.get(Y)?(z.add(N),j(S)):(L.add(Y),h--):(l(D,r),h--)}for(;h--;){const S=o[h];k.has(S.key)||l(S,r)}for(;v;)j(g[v-1]);return se(E),g}function Xe(o){o&&o.c()}function ze(o,e,t){const{fragment:n,after_update:s}=o.$$;n&&n.m(e,t),it(()=>{const a=o.$$.on_mount.map(ln).filter(ut);o.$$.on_destroy?o.$$.on_destroy.push(...a):se(a),o.$$.on_mount=[]}),s.forEach(it)}function He(o,e){const t=o.$$;t.fragment!==null&&(wn(t.after_update),se(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function En(o,e){o.$$.dirty[0]===-1&&(De.push(o),_n(),o.$$.dirty.fill(0)),o.$$.dirty[e/31|0]|=1<<e%31}function Ge(o,e,t,n,s,a,r=null,c=[-1]){const l=Oe;Re(o);const u=o.$$={fragment:null,ctx:[],props:a,update:U,not_equal:s,bound:Lt(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(l?l.$$.context:[])),callbacks:Lt(),dirty:c,skip_bound:!1,root:e.target||l.$$.root};r&&r(u.root);let f=!1;if(u.ctx=t?t(o,e.props||{},(m,h,...v)=>{const _=v.length?v[0]:h;return u.ctx&&s(u.ctx[m],u.ctx[m]=_)&&(!u.skip_bound&&u.bound[m]&&u.bound[m](_),f&&En(o,m)),h}):[],u.update(),f=!0,se(u.before_update),u.fragment=n?n(u.ctx):!1,e.target){if(e.hydrate){const m=gn(e.target);u.fragment&&u.fragment.l(m),m.forEach(C)}else u.fragment&&u.fragment.c();e.intro&&K(o.$$.fragment),ze(o,e.target,e.anchor),cn()}Re(l)}class qe{constructor(){nt(this,"$$");nt(this,"$$set")}$destroy(){He(this,1),this.$destroy=U}$on(e,t){if(!ut(t))return U;const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const s=n.indexOf(t);s!==-1&&n.splice(s,1)}}$set(e){this.$$set&&!fn(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const $n="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add($n);const Se=[];function Cn(o,e){return{subscribe:pe(o,e).subscribe}}function pe(o,e=U){let t;const n=new Set;function s(c){if(Me(o,c)&&(o=c,t)){const l=!Se.length;for(const u of n)u[1](),Se.push(u,o);if(l){for(let u=0;u<Se.length;u+=2)Se[u][0](Se[u+1]);Se.length=0}}}function a(c){s(c(o))}function r(c,l=U){const u=[c,l];return n.add(u),n.size===1&&(t=e(s,a)||U),c(o),()=>{n.delete(u),n.size===0&&t&&(t(),t=null)}}return{set:s,update:a,subscribe:r}}function vt(o,e,t){const n=!Array.isArray(o),s=n?[o]:o;if(!s.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");const a=e.length<2;return Cn(t,(r,c)=>{let l=!1;const u=[];let f=0,m=U;const h=()=>{if(f)return;m();const _=e(n?u[0]:u,r,c);a?r(_):m=ut(_)?_:U},v=s.map((_,$)=>dt(_,g=>{u[$]=g,f&=~(1<<$),l&&h()},()=>{f|=1<<$}));return l=!0,h(),function(){se(v),m(),l=!1}})}const ve=pe(null),We=pe(!1),In=pe(null),st=pe([{countryCodeISO3:"UGA",countryName:"Uganda",name:"Uganda",region:"East Africa",coordinates:{lat:1.3733,lng:32.2903},defaultZoom:7,population:45741007,countryBounds:[[28.8,-1.5],[35,4.2]]},{countryCodeISO3:"ETH",countryName:"Ethiopia",name:"Ethiopia",region:"East Africa",coordinates:{lat:9.145,lng:40.4897},defaultZoom:6,population:114963588,countryBounds:[[32.9,3.4],[47.9,14.9]]},{countryCodeISO3:"KEN",countryName:"Kenya",name:"Kenya",region:"East Africa",coordinates:{lat:-.0236,lng:37.9062},defaultZoom:6,population:53771296,countryBounds:[[33.9,-4.7],[41.9,5.5]]},{countryCodeISO3:"PHL",countryName:"Philippines",name:"Philippines",region:"Southeast Asia",coordinates:{lat:12.8797,lng:121.774},defaultZoom:6,population:109581078,countryBounds:[[114,4.2],[126.6,21.1]]},{countryCodeISO3:"BGD",countryName:"Bangladesh",name:"Bangladesh",region:"South Asia",coordinates:{lat:23.685,lng:90.3563},defaultZoom:7,population:164689383,countryBounds:[[88,20.7],[92.7,26.6]]}]),yt=pe({mode:"full",showControls:!0,showLegend:!0});vt(yt,o=>o.mode!=="full");vt(yt,o=>o.showControls);vt(yt,o=>o.mode==="minimal");function Ln(o){In.set(o),o&&console.error("IBF Error:",o)}function Ft(o){We.set(o)}const Tn="modulepreload",Sn=function(o){return"/"+o},Pt={},Bt=function(e,t,n){let s=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const r=document.querySelector("meta[property=csp-nonce]"),c=(r==null?void 0:r.nonce)||(r==null?void 0:r.getAttribute("nonce"));s=Promise.allSettled(t.map(l=>{if(l=Sn(l),l in Pt)return;Pt[l]=!0;const u=l.endsWith(".css"),f=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${f}`))return;const m=document.createElement("link");if(m.rel=u?"stylesheet":Tn,u||(m.as="script"),m.crossOrigin="",m.href=l,c&&m.setAttribute("nonce",c),document.head.appendChild(m),u)return new Promise((h,v)=>{m.addEventListener("load",h),m.addEventListener("error",()=>v(new Error(`Unable to preload CSS for ${l}`)))})}))}function a(r){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=r,window.dispatchEvent(c),!c.defaultPrevented)throw r}return s.then(r=>{for(const c of r||[])c.status==="rejected"&&a(c.reason);return e().catch(a)})},Dn={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_API_URL:"https://api.ibf-system.org/api",VITE_APP_TITLE:"IBF Dashboard",VITE_DEBUG:"false",VITE_DEBUG_MODE:"true",VITE_DISABLE_API_CACHE:"true",VITE_DISABLE_AUTHENTICATION:"false",VITE_EMBED_ALLOWED_ORIGINS:"https://your-espocrm-domain.com,https://your-other-domain.com",VITE_GEOSERVER_URL:"https://geoserver.ibf-system.org",VITE_IBF_API_EMAIL:"",VITE_IBF_API_PASSWORD:"",VITE_SHOW_DEBUG_PANEL:"true",VITE_USE_IBF_API:"true",VITE_USE_MOCK_DATA:"false"};function me(o,e=""){return Dn[o]||e}function Ee(o,e=!1){const t=me(o,e.toString());return t==="true"||t==="1"}function Fn(){const o=me("VITE_IBF_API_EMAIL",""),e=me("VITE_IBF_API_PASSWORD","");(o||e)&&(console.error("🚨 SECURITY WARNING: IBF API credentials detected in frontend!"),console.error("❌ Frontend credentials are visible to all users"),console.error("✅ Use backend proxy or OAuth flow instead"),console.error("📖 See SECURITY_ALERT.md for details"))}const J={apiUrl:me("VITE_API_URL","http://localhost:3000/api"),useMockData:Ee("VITE_USE_MOCK_DATA",!0),useIbfApi:Ee("VITE_USE_IBF_API",!1),ibfApiEmail:me("VITE_IBF_API_EMAIL",""),ibfApiPassword:me("VITE_IBF_API_PASSWORD",""),disableAuthentication:Ee("VITE_DISABLE_AUTHENTICATION",!0),azureClientId:me("VITE_AZURE_CLIENT_ID",""),azureTenantId:me("VITE_AZURE_TENANT_ID",""),azureRedirectUri:me("VITE_AZURE_REDIRECT_URI","http://localhost:5173/auth/callback"),azureScopes:me("VITE_AZURE_SCOPES","openid profile email").split(" "),isDevelopment:Ee("VITE_IS_DEVELOPMENT",!0),debugMode:Ee("VITE_DEBUG_MODE",!0),showDebugPanel:Ee("VITE_SHOW_DEBUG_PANEL",!0),disableApiCache:Ee("VITE_DISABLE_API_CACHE",!1)};J.debugMode&&(console.log("🔧 IBF Dashboard Configuration:",{useMockData:J.useMockData,useIbfApi:J.useIbfApi,disableAuthentication:J.disableAuthentication,isDevelopment:J.isDevelopment,debugMode:J.debugMode,showDebugPanel:J.showDebugPanel}),Fn());const Pe=pe(!1),Fe=pe(null),Ue=pe(null),ue=pe(null),ct=pe(!1);class Pn{constructor(){this.tokenValidationCache=new Map,this.config={clientId:void 0,tenantId:void 0,redirectUri:void 0,scopes:"openid profile email".split(" ")}}async initializeFromParent(){try{return window.parent===window?await this.handleStandaloneAuth():await this.requestTokenFromParent()}catch(e){return console.error("Authentication initialization failed:",e),ue.set("Failed to initialize authentication"),!1}}async requestTokenFromParent(){return new Promise(e=>{const t=async n=>{if(!this.isValidOrigin(n.origin)){console.warn("Received message from unauthorized origin:",n.origin);return}if(n.data.type==="IBF_AUTH_TOKEN"){window.removeEventListener("message",t);const s=await this.handleTokenFromParent(n.data.token);e(s)}else n.data.type==="IBF_AUTH_ERROR"&&(window.removeEventListener("message",t),ue.set(n.data.error||"Authentication failed"),e(!1))};window.addEventListener("message",t),window.parent.postMessage({type:"IBF_REQUEST_AUTH",data:{origin:window.location.origin,scopes:this.config.scopes}},"*"),setTimeout(()=>{window.removeEventListener("message",t),ue.set("Authentication timeout"),e(!1)},1e4)})}async handleTokenFromParent(e){if(!e)return ue.set("No authentication token received"),!1;try{const t=await this.validateAzureADToken(e);return t.valid&&t.user?(Ue.set(e),Fe.set(t.user),Pe.set(!0),ue.set(null),this.storeTokenSecurely(e),!0):(ue.set(t.error||"Token validation failed"),!1)}catch(t){return console.error("Token validation error:",t),ue.set("Token validation failed"),!1}}async validateAzureADToken(e){const t=this.tokenValidationCache.get(e);if(t&&Date.now()-t.timestamp<5*60*1e3)return{valid:t.valid};try{const n=await fetch(`https://login.microsoftonline.com/${this.config.tenantId}/oauth2/v2.0/userinfo`,{headers:{Authorization:`Bearer ${e}`,Accept:"application/json"}});if(!n.ok)throw new Error(`Azure AD validation failed: ${n.status}`);const s=await n.json();if(!this.validateTokenClaims(s))return{valid:!1,error:"Invalid token claims"};const a={id:s.sub||s.oid,email:s.email||s.preferred_username,name:s.name||`${s.given_name} ${s.family_name}`,roles:s.roles||[],permissions:this.mapRolesToPermissions(s.roles||[])};return this.tokenValidationCache.set(e,{valid:!0,timestamp:Date.now()}),{valid:!0,user:a}}catch(n){return console.error("Azure AD token validation failed:",n),this.tokenValidationCache.set(e,{valid:!1,timestamp:Date.now()}),{valid:!1,error:n.message}}}validateTokenClaims(e){return!e.sub&&!e.oid?(console.error("Token missing user identifier"),!1):!e.email&&!e.preferred_username?(console.error("Token missing email"),!1):e.aud&&e.aud!==this.config.clientId?(console.error("Token audience mismatch"),!1):e.exp&&Date.now()>=e.exp*1e3?(console.error("Token expired"),!1):!0}mapRolesToPermissions(e){const t={"IBF.Admin":["read","write","admin","manage_users"],"IBF.User":["read","write"],"IBF.Viewer":["read"],"EspoCRM.User":["read"]},n=new Set;return e.forEach(s=>{const a=t[s];a&&a.forEach(r=>n.add(r))}),n.size===0&&n.add("read"),Array.from(n)}async handleStandaloneAuth(){const e=this.getStoredToken();if(e){const t=this.isIBFToken(e)?await this.validateIBFToken(e):await this.validateAzureADToken(e);if(t.valid)return Ue.set(e),Fe.set(t.user||null),Pe.set(!0),!0;this.clearStoredToken()}return!1}async validateIBFToken(e){var t;try{const n=JSON.parse(atob(e.split(".")[1]));return n.exp&&Date.now()>=n.exp*1e3?{valid:!1,error:"Token expired"}:{valid:!0,user:{id:n.email,email:n.email,name:n.firstName&&n.lastName?`${n.firstName} ${n.middleName||""} ${n.lastName}`.trim():n.email,roles:[n.userRole||n.role],permissions:this.mapIBFRoleToPermissions(n.userRole||n.role),country:(t=n.countries)==null?void 0:t[0]}}}catch(n){return console.error("IBF token validation failed:",n),{valid:!1,error:"Invalid token format"}}}redirectToAzureAD(){const e=new URLSearchParams({client_id:this.config.clientId,response_type:"token",redirect_uri:this.config.redirectUri,scope:this.config.scopes.join(" "),response_mode:"fragment",state:this.generateState(),nonce:this.generateNonce()}),t=`https://login.microsoftonline.com/${this.config.tenantId}/oauth2/v2.0/authorize?${e}`;window.location.href=t}generateState(){const e=new Uint8Array(32);return crypto.getRandomValues(e),btoa(String.fromCharCode(...e))}generateNonce(){const e=new Uint8Array(16);return crypto.getRandomValues(e),btoa(String.fromCharCode(...e))}storeTokenSecurely(e){const t={token:e,timestamp:Date.now(),expires:Date.now()+36e5};sessionStorage.setItem("ibf_auth_token",JSON.stringify(t))}getStoredToken(){try{const e=sessionStorage.getItem("ibf_auth_token");if(!e)return null;const t=JSON.parse(e);return Date.now()>t.expires?(this.clearStoredToken(),null):t.token}catch{return null}}clearStoredToken(){sessionStorage.removeItem("ibf_auth_token")}isValidOrigin(e){return("https://your-espocrm-domain.com,https://your-other-domain.com".split(",")||[]).includes(e)||e===window.location.origin}getAuthToken(){return ye(Ue)}hasPermission(e){const t=ye(Fe);return t!==null&&t.permissions.includes(e)}async loginWithIBF(e,t){var n;try{ct.set(!0),ue.set(null),console.log("🔐 Attempting login to IBF API...");const s="https://api.ibf-system.org/api";console.log("🌐 Using API URL:",s);const a=await fetch(`${s}/user/login`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({email:e,password:t})});if(!a.ok){const l=await a.json().catch(()=>({message:"Login failed"}));throw new Error(l.message||`HTTP ${a.status}: ${a.statusText}`)}const r=await a.json();if(!r.user||!r.user.token)throw new Error("Invalid response from authentication server");const c={id:r.user.email,email:r.user.email,name:`${r.user.firstName} ${r.user.middleName||""} ${r.user.lastName}`.trim(),roles:[r.user.userRole],permissions:this.mapIBFRoleToPermissions(r.user.userRole),country:(n=r.user.countries)==null?void 0:n[0]};return Ue.set(r.user.token),Fe.set(c),Pe.set(!0),ue.set(null),this.storeTokenSecurely(r.user.token),console.log("✅ IBF login successful"),!0}catch(s){console.error("❌ IBF login failed:",s);const a=s instanceof Error?s.message:"Login failed";return ue.set(a),!1}finally{ct.set(!1)}}mapIBFRoleToPermissions(e){return{admin:["read","write","admin","manage_users"],user:["read","write"],viewer:["read"]}[e==null?void 0:e.toLowerCase()]||["read"]}isIBFToken(e){try{const t=JSON.parse(atob(e.split(".")[1]));return t.email&&(t.userRole||t.role)}catch{return!1}}logout(){this.clearStoredToken(),Ue.set(null),Fe.set(null),Pe.set(!1),ue.set(null),window.parent!==window&&window.parent.postMessage({type:"IBF_LOGOUT"},"*")}async refreshToken(){return window.parent!==window?await this.requestTokenFromParent():(this.redirectToAzureAD(),!1)}}const Ve=new Pn;typeof window<"u"&&Ve.initializeFromParent();const Nt="https://ibf-test.510.global/api";class Bn{constructor(){this.cache=new Map,this.currentToken=null,setInterval(()=>this.clearExpiredCache(),15*60*1e3)}setManualToken(e){this.currentToken=e,console.log("🔑 Manual token set for testing")}async getIbfToken(){const e=Ve.getAuthToken();return e?(console.log("✅ Using token from auth service"),e):(console.log("❌ No token available from auth service"),null)}async request(e,t={},n=10*60*1e3){const s=`${Nt}${e}`,a=`${s}:${JSON.stringify(t)}`;if((!t.method||t.method==="GET")&&!J.disableApiCache){const c=this.cache.get(a);if(c&&Date.now()-c.timestamp<c.ttl)return console.log(`🗄️ Cache hit for: ${e}`),{data:c.data,status:200}}const r=J.disableApiCache?{"Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:"0"}:{};try{Ft(!0);const c=await this.getIbfToken(),l=t.method||"GET",u={Accept:"application/json","Content-Type":"application/json; charset=utf-8","User-Agent":"VRC",...c&&{Authorization:`Bearer ${c}`},...r,...t.headers};console.group(`🌐 IBF API Request: ${l} ${e}${J.disableApiCache?" [CACHE DISABLED]":""}`),console.log(`📍 Full URL: ${s}`),console.log(`🔧 Method: ${l}`),console.log(`🎯 Endpoint: ${e}`),console.log(`🗄️ Cache Status: ${J.disableApiCache?"DISABLED":"ENABLED"}`),console.log(`🔑 Has Token: ${!!c}`),c&&console.log(`🎫 Token Preview: ${c.substring(0,10)}...`),console.log("📋 Headers:",u),t.body&&console.log("📦 Body:",t.body),console.groupEnd();const f=await fetch(s,{...t,headers:u}),m=await f.json();if(!f.ok){if(console.group(`❌ IBF API Error: ${l} ${e}`),console.log(`📍 URL: ${s}`),console.log(`📊 Status: ${f.status} ${f.statusText}`),console.log("📄 Response:",m),console.groupEnd(),f.status===401||f.status===403){console.log("🔄 Authentication failed, trying to refresh token..."),this.currentToken=null;const h=await this.getIbfToken();if(h){const v={...u,Authorization:`Bearer ${h}`},_=await fetch(s,{...t,headers:v});if(_.ok){const $=await _.json();return console.log("✅ Retry successful after token refresh"),{data:$,status:_.status}}}}return{error:m.message||`IBF API Error: ${f.status}`,status:f.status}}if((!t.method||t.method==="GET")&&!J.disableApiCache&&this.cache.set(a,{data:m,timestamp:Date.now(),ttl:n}),console.group(`✅ IBF API Success: ${l} ${e}`),console.log(`📍 URL: ${s}`),console.log(`📊 Status: ${f.status} ${f.statusText}`),console.log(`📦 Data Size: ${JSON.stringify(m).length} characters`),Array.isArray(m))console.log(`📋 Array Length: ${m.length} items`),console.log(`📄 First ${Math.min(m.length,3)} items:`,m.slice(0,3));else if(m&&typeof m=="object"){console.log("📄 Object Keys:",Object.keys(m));const v=JSON.stringify(m,null,2).split(`
`),_=v.slice(0,100).join(`
`),$=v.length>100;console.log(`📋 Response Preview (${$?`first 100 of ${v.length}`:v.length} lines):`),console.log(_),$&&console.log(`... [${v.length-100} more lines truncated]`)}else console.log("📄 Response Data:",m);return console.groupEnd(),{data:m,status:f.status}}catch(c){const l=t.method||"GET",u=c instanceof Error?c.message:"IBF API Network Error";return console.group(`💥 IBF API Network Error: ${l} ${e}`),console.log(`📍 URL: ${s}`),console.log("⚠️ Error:",c),console.groupEnd(),Ln(u),{error:u,status:0}}finally{Ft(!1)}}clearExpiredCache(){const e=Date.now();for(const[t,n]of this.cache.entries())e-n.timestamp>n.ttl&&this.cache.delete(t)}async getCountries(){return this.request("/country",{},30*60*1e3)}async getCountry(e){return this.request(`/country?countryCodes=${e}`,{},30*60*1e3)}async getDisasterTypes(e){const t=await this.getCountries();if(t.data){const n=t.data.find(s=>s.countryCodeISO3===e);if(n!=null&&n.countryDisasterSettings)return{data:n.countryDisasterSettings,status:200}}return{error:"No disaster types found for country",status:404}}async getAdminAreas(e,t=2){console.log(`🗺️ Attempting to get admin areas for ${e} at level ${t}`);try{const n=`${Nt}/admin-areas/${e}/${t}`;console.log(`🌐 Trying public access to: ${n}`);const s=await fetch(n,{headers:{Accept:"application/json","Content-Type":"application/json; charset=utf-8","User-Agent":"VRC"}});if(s.ok){const a=await s.json();return console.log(`✅ Public admin areas access successful for ${e}`),{data:a,status:s.status}}else console.log(`❌ Public access failed with status: ${s.status}, trying authenticated request...`)}catch(n){console.log("❌ Public access error:",n)}return this.request(`/admin-areas/${e}/${t}`,{},20*60*1e3)}async getAdminAreaGeometry(e,t=2){return this.getAdminAreas(e,t)}async getAdminAreasList(e,t=2){const n=await this.getAdminAreas(e,t);return n.error||!n.data?{error:n.error||"Failed to fetch admin areas",status:n.status}:{data:n.data.features.map(a=>({placeCode:a.properties.adm2_pcode||a.properties.adm1_pcode||"UNKNOWN",name:a.properties.adm2_en||a.properties.adm1_en||"Unknown Area",adminLevel:t,countryCodeISO3:e,geom:a.geometry})),status:n.status}}async getEvents(e,t,n){const s=new URLSearchParams;n&&s.set("leadTime",n);const a=`/event/${e}/${t}${s.toString()?"?"+s.toString():""}`;return this.request(a,{},5*60*1e3)}async getEventData(e,t,n){const s=new URLSearchParams;n&&s.set("leadTime",n);const a=`/event/${e}/${t}/data${s.toString()?"?"+s.toString():""}`;return this.request(a,{},5*60*1e3)}async getMetadata(e,t,n){return this.request(`/metadata/${e}/${t}/${n}`,{},15*60*1e3)}async getIndicatorData(e,t,n,s){return this.request(`/indicators/${e}/${t}/${n}/${s}`,{},10*60*1e3)}async getUserProfile(){return this.request("/user/current")}async healthCheck(){return this.request("/health",{},60*1e3)}async getDashboardData(e,t,n){var s,a,r,c;try{console.log(`Loading dashboard data for ${e}, disaster: ${t}`);const l=await this.getCountry(e);if(!l.data)return{error:"Country not found",status:404};const u=l.data,f=u.countryDisasterSettings||[],m=t||((s=f.find(z=>z.active))==null?void 0:s.disasterType)||(f.length>0?f[0].disasterType:null),[h,v]=await Promise.all([this.getAdminAreas(e,u.adminLevel||2),this.getAdminAreasList(e,u.adminLevel||2)]);if(!m)return console.log("🔍 No disaster type found, returning admin areas only"),{data:{country:u,adminAreas:h.data||null,adminAreasList:v.data||[],events:[],metadata:[],disasterTypes:f,layers:[{id:`${e}_admin_areas`,name:"Administrative Areas",active:!0,type:"geojson",data:{visible:!0,opacity:.7,adminAreas:v.data||[]}}]},status:200};const _=f.find(z=>z.disasterType===m),$=n||(_==null?void 0:_.leadTimeValue)||"1-day",[g,k]=await Promise.all([this.getEvents(e,m,$),this.getMetadata(e,m,$)]);console.group("🔍 Dashboard Data - Admin Areas Debug"),console.log("AdminAreasGeoJson response:",h),console.log("AdminAreasGeoJson.data:",h.data),console.log("AdminAreasGeoJson.data type:",typeof h.data),console.log("AdminAreasGeoJson.data is null?",h.data===null),console.log("AdminAreasGeoJson.data is undefined?",h.data===void 0),h.data&&(console.log("AdminAreasGeoJson.data.type:",h.data.type),console.log("AdminAreasGeoJson.data.features.length:",(a=h.data.features)==null?void 0:a.length)),console.log("AdminAreasList response:",v),console.groupEnd();const b=[{id:`${e}_admin_areas`,name:"Administrative Areas",active:!0,type:"geojson",data:{visible:!0,opacity:.7,adminAreas:v.data||[]}},{id:`${e}_events`,name:"Active Events",active:(g==null?void 0:g.data)&&g.data.length>0,type:"marker",data:{visible:!0,markerType:"alert",events:(g==null?void 0:g.data)||[]}}],E=h.data||null;console.group("🔍 Dashboard Data - Final Structure Debug"),console.log("Final adminAreas value:",E),console.log("Final adminAreas is null?",E===null),console.log("Final adminAreas type:",typeof E),E&&(console.log("Final adminAreas.type:",E.type),console.log("Final adminAreas.features.length:",(r=E.features)==null?void 0:r.length)),console.groupEnd();const L={country:u,adminAreas:E,adminAreasList:v.data||[],events:(g==null?void 0:g.data)||[],metadata:(k==null?void 0:k.data)||[],disasterTypes:f,layers:b};return console.group("🚀 FINAL RETURN - Dashboard Data Structure"),console.log("finalData object:",L),console.log("finalData.adminAreas:",L.adminAreas),console.log("finalData.adminAreas === null?",L.adminAreas===null),console.log("finalData.adminAreas type:",typeof L.adminAreas),L.adminAreas&&(console.log("finalData.adminAreas.type:",L.adminAreas.type),console.log("finalData.adminAreas.features?.length:",(c=L.adminAreas.features)==null?void 0:c.length)),console.groupEnd(),{data:L,status:200}}catch(l){const u=l instanceof Error?l.message:"Failed to load dashboard data";return console.error("Dashboard data loading failed:",l),{error:u,status:500}}}transformCountryData(e){return{countryCodeISO3:e.countryCodeISO3,countryName:e.countryName,countryBounds:e.countryBounds||[[-180,-90],[180,90]],population:null,riskLevel:"Unknown",lastUpdate:new Date().toISOString()}}transformEventData(e,t){return e.flatMap(n=>n.adminAreas?n.adminAreas.map((s,a)=>({id:`${n.countryCodeISO3}_${n.disasterType}_${s.placeCode}`,disasterType:n.disasterType,eventName:n.eventName||`${n.disasterType} Alert`,placeCode:s.placeCode,placeName:s.name,adminLevel:s.adminLevel,thresholdValue:n.thresholdValue,thresholdOperator:n.thresholdOperator,date:n.date||new Date().toISOString(),lat:null,lon:null,severity:this.calculateSeverity(n.thresholdValue),affectedPeople:null,description:`${n.disasterType} event in ${s.name}`})):[])}calculateSeverity(e){return e?e>.7?"High":e>.4?"Medium":"Low":"Unknown"}transformDisasterTypes(e){return e.map(t=>({disasterType:t.disasterType,label:t.label||t.disasterType.charAt(0).toUpperCase()+t.disasterType.slice(1),active:t.active,leadTime:`${t.leadTimeValue}-${t.leadTimeUnit}`,leadTimeValue:t.leadTimeValue,leadTimeUnit:t.leadTimeUnit}))}async getLayers(e,t){try{return console.log(`🗂️ Getting layers for ${e} - ${t}`),await this.request(`/metadata/layers/${e}/${t}`)}catch(n){return console.error("❌ Error fetching layers:",n),{error:n.message,status:500}}}async getPointData(e,t,n){try{console.log(`📍 Getting point data for ${t} in ${e}`);const s=`/point-data/${t}/${e}?disasterType=${n}`;return await this.request(s)}catch(s){return console.error("❌ Error fetching point data:",s),{error:s.message,status:500}}}async getAggregatedData(e,t,n,s){try{console.log(`📊 Getting aggregated data for area ${n} in ${e}`);const a=[`/aggregates/${e}/${t}/${s}?placeCode=${n}`,`/admin-areas/${e}/${s}?placeCode=${n}`,`/indicators/${e}/${t}/${s}?placeCode=${n}`];for(const r of a)try{const c=await this.request(r);if(c.data&&!c.error)return console.log(`✅ Got aggregated data from ${r}`),c}catch(c){console.log(`⚠️ Endpoint ${r} failed:`,c.message)}return console.log("❌ No aggregated data available from any endpoint"),{error:"No aggregated data available",status:404}}catch(a){return console.error("❌ Error fetching aggregated data:",a),{error:a.message,status:500}}}async getWaterpoints(e){try{return console.log(`💧 Getting waterpoints for ${e}`),await this.request(`/waterpoints/${e}`)}catch(t){return console.error("❌ Error fetching waterpoints:",t),{error:t.message,status:500}}}async getTyphoonTrack(e,t){try{console.log(`🌀 Getting typhoon track for ${e}${t?` - ${t}`:""}`);const n=`/typhoon-track/${e}${t?`?eventName=${t}`:""}`;return await this.request(n)}catch(n){return console.error("❌ Error fetching typhoon track:",n),{error:n.message,status:500}}}async getIndicators(e,t){try{return console.log(`📊 Getting indicators for ${e} - ${t}`),await this.request(`/metadata/indicators/${e}/${t}`)}catch(n){return console.error("❌ Error fetching indicators:",n),{error:n.message,status:500}}}async getLastUploadDate(e,t){try{return console.log(`📅 Getting last upload date for ${e} - ${t}`),await this.request(`/event/last-upload-date/${e}/${t}`)}catch(n){return console.error("❌ Error fetching last upload date:",n),{error:n.message,status:500}}}}const Ce=new Bn,Mt={base:{iconSize:[28,42],iconAnchor:[24,42],popupAnchor:[0,-28]},markers:{glofasStation:{default:"/assets/markers/glofas-station-no-trigger.svg",min:"/assets/markers/glofas-station-min-trigger.svg",med:"/assets/markers/glofas-station-med-trigger.svg",max:"/assets/markers/glofas-station-max-trigger.svg"},waterpoint:{default:"/assets/markers/water-point-marker.svg",exposed:"/assets/markers/water-point-marker-exposed.svg"},healthSite:{default:"/assets/markers/health-center-marker.svg",exposed:"/assets/markers/health-center-marker-exposed.svg"},school:{default:"/assets/markers/school-marker.svg",exposed:"/assets/markers/school-marker-exposed.svg"},redCrossBranch:"/assets/markers/red-cross-marker.svg",evacuationCenter:"/assets/markers/evacuation-center-marker.svg",damSite:"/assets/markers/dam-marker.svg",communityNotification:"/assets/markers/community-notification-marker.svg",riverGauge:"/assets/markers/river-gauge-marker.svg",typhoonTrack:"/assets/markers/typhoon-track.png"}};class Nn{constructor(){this.layers=[],this.layerCache=new Map}async getLayersForCountry(e,t){try{console.log(`🗺️ Loading layers for ${e} - ${t}`);const n=await Ce.getLayers(e,t);if(n.error||!n.data)return console.warn("⚠️ No layers data available, using fallback layers"),this.getFallbackLayers(t);const s=n.data.map(a=>this.transformLayerMetadata(a));return console.log(`✅ Loaded ${s.length} layers:`,s.map(a=>a.name)),this.layers=s,s}catch(n){return console.error("❌ Error loading layers:",n),this.getFallbackLayers(t)}}async loadLayerData(e,t,n,s){var r;const a=`${e.name}_${t}_${n}_${s||"no-event"}`;if(this.layerCache.has(a))return console.log(`🗄️ Using cached data for layer: ${e.name}`),this.layerCache.get(a);try{let c=null;switch(e.name){case"waterpoints":console.log(`💧 Loading waterpoints for ${t}`),c=(await Ce.getWaterpoints(t)).data||null;break;case"typhoon_track":console.log(`🌀 Loading typhoon track for ${t}`),c=(await Ce.getTyphoonTrack(t,s)).data||null;break;case"glofas_stations":case"health_sites":case"schools":case"waterpoints_internal":case"red_cross_branches":case"evacuation_centers":case"dams":case"community_notifications":case"gauges":console.log(`📍 Loading point data for ${e.name} in ${t}`),c=(await Ce.getPointData(t,e.name,n)).data||null;break;default:console.log(`⚠️ Unknown layer type: ${e.name}, skipping data load`);break}if(c){this.layerCache.set(a,c);const l=((r=c==null?void 0:c.features)==null?void 0:r.length)||(Array.isArray(c)?c.length:0);console.log(`✅ Loaded data for layer ${e.name}: ${l} features`)}return c}catch(c){return console.error(`❌ Error loading data for layer ${e.name}:`,c),null}}createPointMarker(e,t,n){const{geometry:s,properties:a}=e,[r,c]=s.coordinates,l=n.latLng(c,r),u=this.getMarkerIcon(t,a),f={icon:n.icon({iconUrl:u,...Mt.base})},m=n.marker(l,f),h=this.createPopupContent(t,a);return h&&m.bindPopup(h),m}getMarkerIcon(e,t){var s,a,r,c;const{markers:n}=Mt;switch(e){case"glofas_stations":const l=((s=t.dynamicData)==null?void 0:s.eapAlertClass)||"no";return l==="max"?n.glofasStation.max:l==="med"?n.glofasStation.med:l==="min"?n.glofasStation.min:n.glofasStation.default;case"waterpoints":return n.waterpoint.default;case"waterpoints_internal":return(a=t.dynamicData)!=null&&a.exposure?n.waterpoint.exposed:n.waterpoint.default;case"health_sites":return(r=t.dynamicData)!=null&&r.exposure?n.healthSite.exposed:n.healthSite.default;case"schools":return(c=t.dynamicData)!=null&&c.exposure?n.school.exposed:n.school.default;case"red_cross_branches":return n.redCrossBranch;case"evacuation_centers":return n.evacuationCenter;case"dams":return n.damSite;case"community_notifications":return n.communityNotification;case"gauges":return n.riverGauge;case"typhoon_track":return n.typhoonTrack;default:return n.waterpoint.default}}createPopupContent(e,t){var s,a,r;let n='<div class="marker-popup">';switch(e){case"glofas_stations":n+=`
          <h4>${t.stationName||"Station"}</h4>
          <p><strong>Code:</strong> ${t.stationCode||"N/A"}</p>
          ${t.dynamicData?`
            <p><strong>Alert Class:</strong> ${t.dynamicData.eapAlertClass||"None"}</p>
            <p><strong>Forecast Level:</strong> ${t.dynamicData.forecastLevel||"N/A"}</p>
            <p><strong>Trigger Level:</strong> ${t.dynamicData.triggerLevel||"N/A"}</p>
          `:""}
        `;break;case"health_sites":n+=`
          <h4>${t.name||"Health Site"}</h4>
          <p><strong>Type:</strong> ${t.type||"N/A"}</p>
          ${(s=t.dynamicData)!=null&&s.exposure?`
            <p><strong>Status:</strong> <span style="color: red;">Exposed</span></p>
          `:'<p><strong>Status:</strong> <span style="color: green;">Safe</span></p>'}
        `;break;case"schools":n+=`
          <h4>${t.name||"School"}</h4>
          <p><strong>Type:</strong> ${t.type||"N/A"}</p>
          ${(a=t.dynamicData)!=null&&a.exposure?`
            <p><strong>Status:</strong> <span style="color: red;">Exposed</span></p>
          `:'<p><strong>Status:</strong> <span style="color: green;">Safe</span></p>'}
        `;break;case"waterpoints":n+=`
          <h4>Waterpoint</h4>
          <p><strong>ID:</strong> ${t.wpdxId||"N/A"}</p>
          <p><strong>Type:</strong> ${t.type||"N/A"}</p>
          <p><strong>Report Date:</strong> ${t.reportDate||"N/A"}</p>
        `;break;case"waterpoints_internal":n+=`
          <h4>${t.name||"Waterpoint"}</h4>
          <p><strong>Type:</strong> ${t.type||"N/A"}</p>
          ${(r=t.dynamicData)!=null&&r.exposure?`
            <p><strong>Status:</strong> <span style="color: red;">Exposed</span></p>
          `:'<p><strong>Status:</strong> <span style="color: green;">Safe</span></p>'}
        `;break;case"red_cross_branches":n+=`
          <h4>${t.branchName||"Red Cross Branch"}</h4>
          <p><strong>Volunteers:</strong> ${t.numberOfVolunteers||"N/A"}</p>
          <p><strong>Contact:</strong> ${t.contactPerson||"N/A"}</p>
          ${t.contactNumber?`<p><strong>Phone:</strong> ${t.contactNumber}</p>`:""}
        `;break;case"evacuation_centers":n+=`
          <h4>${t.evacuationCenterName||"Evacuation Center"}</h4>
          <p><strong>Location:</strong> ${t.latitude}, ${t.longitude}</p>
        `;break;case"dams":n+=`
          <h4>${t.damName||"Dam Site"}</h4>
          <p><strong>Capacity:</strong> ${t.fullSupplyCapacity||"N/A"}</p>
        `;break;case"typhoon_track":n+=`
          <h4>Typhoon Track Point</h4>
          <p><strong>Time:</strong> ${t.timestampOfTrackpoint||"N/A"}</p>
          <p><strong>Category:</strong> ${t.category||"N/A"}</p>
          <p><strong>Wind Speed:</strong> ${t.windspeed||"N/A"} km/h</p>
          ${t.firstLandfall?"<p><strong>First Landfall</strong></p>":""}
          ${t.closestToLand?"<p><strong>Closest to Land</strong></p>":""}
        `;break;default:n+="<h4>Point of Interest</h4><p>Click for details</p>";break}return n+="</div>",n}transformLayerMetadata(e){return{name:e.name,label:e.label||e.name,type:e.type,group:this.getLayerGroup(e.type),active:e.active==="yes"||e.active===!0,show:!0,description:e.description?JSON.stringify(e.description):"",leadTimeDependent:e.leadTimeDependent||!1,dynamic:e.dynamic||!1,order:e.order||10}}getLayerGroup(e){switch(e){case"point":return"point";case"shape":return"adminRegions";case"wms":return"wms";default:return"point"}}getFallbackLayers(e){const t=[{name:"waterpoints",label:"Waterpoints",type:"point",group:"point",active:!1,show:!0,order:1},{name:"health_sites",label:"Health Sites",type:"point",group:"point",active:!1,show:!0,order:2},{name:"schools",label:"Schools",type:"point",group:"point",active:!1,show:!0,order:3}];return(e==="floods"||e==="flash-floods")&&t.push({name:"glofas_stations",label:"Glofas Stations",type:"point",group:"point",active:!0,show:!0,order:0}),e==="typhoon"&&t.push({name:"typhoon_track",label:"Typhoon Track",type:"point",group:"point",active:!0,show:!0,order:0}),t}clearCache(){this.layerCache.clear(),console.log("🗑️ Layer cache cleared")}getLayers(){return this.layers}updateLayerState(e,t){const n=this.layers.find(s=>s.name===e);n&&(n.active=t,console.log(`🔄 Updated layer ${e} active state: ${t}`))}}const at=new Nn;function xt(o,e,t){const n=o.slice();return n[13]=e[t],n}function Ut(o,e,t){const n=o.slice();return n[13]=e[t],n}function Rt(o,e,t){const n=o.slice();return n[13]=e[t],n}function Ot(o){let e,t,n,s,a,r,c,l,u,f,m,h=!o[2]&&Vt(o);return{c(){e=p("div"),t=p("div"),n=p("h3"),n.textContent="Map Layers",s=w(),a=p("button"),r=oe("svg"),c=oe("path"),u=w(),h&&h.c(),i(n,"class","svelte-5l43hf"),i(c,"d","M7 10l5 5 5-5z"),i(r,"class","icon svelte-5l43hf"),i(r,"viewBox","0 0 24 24"),we(r,"rotated",o[2]),i(a,"class","collapse-btn svelte-5l43hf"),i(a,"aria-label",l=o[2]?"Expand layers panel":"Collapse layers panel"),i(t,"class","layers-header svelte-5l43hf"),i(t,"role","button"),i(t,"tabindex","0"),i(e,"class","layers-control svelte-5l43hf"),we(e,"collapsed",o[2])},m(v,_){I(v,e,_),d(e,t),d(t,n),d(t,s),d(t,a),d(a,r),d(r,c),d(e,u),h&&h.m(e,null),f||(m=[O(t,"click",o[7]),O(t,"keypress",o[8])],f=!0)},p(v,_){_&4&&we(r,"rotated",v[2]),_&4&&l!==(l=v[2]?"Expand layers panel":"Collapse layers panel")&&i(a,"aria-label",l),v[2]?h&&(h.d(1),h=null):h?h.p(v,_):(h=Vt(v),h.c(),h.m(e,null)),_&4&&we(e,"collapsed",v[2])},d(v){v&&C(e),h&&h.d(),f=!1,se(m)}}}function Vt(o){let e,t,n,s,a=o[3].point.length>0&&zt(o),r=o[3].shape.length>0&&qt(o),c=o[3].wms.length>0&&Jt(o),l=o[0].length===0&&Yt();return{c(){e=p("div"),a&&a.c(),t=w(),r&&r.c(),n=w(),c&&c.c(),s=w(),l&&l.c(),i(e,"class","layers-content svelte-5l43hf")},m(u,f){I(u,e,f),a&&a.m(e,null),d(e,t),r&&r.m(e,null),d(e,n),c&&c.m(e,null),d(e,s),l&&l.m(e,null)},p(u,f){u[3].point.length>0?a?a.p(u,f):(a=zt(u),a.c(),a.m(e,t)):a&&(a.d(1),a=null),u[3].shape.length>0?r?r.p(u,f):(r=qt(u),r.c(),r.m(e,n)):r&&(r.d(1),r=null),u[3].wms.length>0?c?c.p(u,f):(c=Jt(u),c.c(),c.m(e,s)):c&&(c.d(1),c=null),u[0].length===0?l||(l=Yt(),l.c(),l.m(e,null)):l&&(l.d(1),l=null)},d(u){u&&C(e),a&&a.d(),r&&r.d(),c&&c.d(),l&&l.d()}}}function zt(o){let e,t,n,s=ke(o[3].point),a=[];for(let r=0;r<s.length;r+=1)a[r]=Gt(Rt(o,s,r));return{c(){e=p("div"),t=p("h4"),t.textContent="Point Data",n=w();for(let r=0;r<a.length;r+=1)a[r].c();i(t,"class","svelte-5l43hf"),i(e,"class","layer-group svelte-5l43hf")},m(r,c){I(r,e,c),d(e,t),d(e,n);for(let l=0;l<a.length;l+=1)a[l]&&a[l].m(e,null)},p(r,c){if(c&56){s=ke(r[3].point);let l;for(l=0;l<s.length;l+=1){const u=Rt(r,s,l);a[l]?a[l].p(u,c):(a[l]=Gt(u),a[l].c(),a[l].m(e,null))}for(;l<a.length;l+=1)a[l].d(1);a.length=s.length}},d(r){r&&C(e),ft(a,r)}}}function Ht(o){let e,t,n;return{c(){e=p("div"),t=x("ℹ️"),i(e,"class","layer-description svelte-5l43hf"),i(e,"title",n=o[13].description)},m(s,a){I(s,e,a),d(e,t)},p(s,a){a&8&&n!==(n=s[13].description)&&i(e,"title",n)},d(s){s&&C(e)}}}function Gt(o){let e,t,n,s,a,r,c,l,u=o[13].label+"",f,m,h,v,_;function $(){return o[9](o[13])}let g=o[13].description&&Ht(o);return{c(){e=p("div"),t=p("label"),n=p("input"),a=w(),r=p("span"),c=w(),l=p("span"),f=x(u),m=w(),g&&g.c(),h=w(),i(n,"type","checkbox"),n.checked=s=o[5](o[13].name),i(n,"class","svelte-5l43hf"),i(r,"class","checkmark svelte-5l43hf"),i(l,"class","layer-label svelte-5l43hf"),i(t,"class","layer-checkbox svelte-5l43hf"),i(e,"class","layer-item svelte-5l43hf")},m(k,b){I(k,e,b),d(e,t),d(t,n),d(t,a),d(t,r),d(t,c),d(t,l),d(l,f),d(e,m),g&&g.m(e,null),d(e,h),v||(_=O(n,"change",$),v=!0)},p(k,b){o=k,b&8&&s!==(s=o[5](o[13].name))&&(n.checked=s),b&8&&u!==(u=o[13].label+"")&&ee(f,u),o[13].description?g?g.p(o,b):(g=Ht(o),g.c(),g.m(e,h)):g&&(g.d(1),g=null)},d(k){k&&C(e),g&&g.d(),v=!1,_()}}}function qt(o){let e,t,n,s=ke(o[3].shape),a=[];for(let r=0;r<s.length;r+=1)a[r]=Zt(Ut(o,s,r));return{c(){e=p("div"),t=p("h4"),t.textContent="Boundaries",n=w();for(let r=0;r<a.length;r+=1)a[r].c();i(t,"class","svelte-5l43hf"),i(e,"class","layer-group svelte-5l43hf")},m(r,c){I(r,e,c),d(e,t),d(e,n);for(let l=0;l<a.length;l+=1)a[l]&&a[l].m(e,null)},p(r,c){if(c&56){s=ke(r[3].shape);let l;for(l=0;l<s.length;l+=1){const u=Ut(r,s,l);a[l]?a[l].p(u,c):(a[l]=Zt(u),a[l].c(),a[l].m(e,null))}for(;l<a.length;l+=1)a[l].d(1);a.length=s.length}},d(r){r&&C(e),ft(a,r)}}}function jt(o){let e,t,n;return{c(){e=p("div"),t=x("ℹ️"),i(e,"class","layer-description svelte-5l43hf"),i(e,"title",n=o[13].description)},m(s,a){I(s,e,a),d(e,t)},p(s,a){a&8&&n!==(n=s[13].description)&&i(e,"title",n)},d(s){s&&C(e)}}}function Zt(o){let e,t,n,s,a,r,c,l,u=o[13].label+"",f,m,h,v,_;function $(){return o[10](o[13])}let g=o[13].description&&jt(o);return{c(){e=p("div"),t=p("label"),n=p("input"),a=w(),r=p("span"),c=w(),l=p("span"),f=x(u),m=w(),g&&g.c(),h=w(),i(n,"type","checkbox"),n.checked=s=o[5](o[13].name),i(n,"class","svelte-5l43hf"),i(r,"class","checkmark svelte-5l43hf"),i(l,"class","layer-label svelte-5l43hf"),i(t,"class","layer-checkbox svelte-5l43hf"),i(e,"class","layer-item svelte-5l43hf")},m(k,b){I(k,e,b),d(e,t),d(t,n),d(t,a),d(t,r),d(t,c),d(t,l),d(l,f),d(e,m),g&&g.m(e,null),d(e,h),v||(_=O(n,"change",$),v=!0)},p(k,b){o=k,b&8&&s!==(s=o[5](o[13].name))&&(n.checked=s),b&8&&u!==(u=o[13].label+"")&&ee(f,u),o[13].description?g?g.p(o,b):(g=jt(o),g.c(),g.m(e,h)):g&&(g.d(1),g=null)},d(k){k&&C(e),g&&g.d(),v=!1,_()}}}function Jt(o){let e,t,n,s=ke(o[3].wms),a=[];for(let r=0;r<s.length;r+=1)a[r]=Kt(xt(o,s,r));return{c(){e=p("div"),t=p("h4"),t.textContent="Raster Data",n=w();for(let r=0;r<a.length;r+=1)a[r].c();i(t,"class","svelte-5l43hf"),i(e,"class","layer-group svelte-5l43hf")},m(r,c){I(r,e,c),d(e,t),d(e,n);for(let l=0;l<a.length;l+=1)a[l]&&a[l].m(e,null)},p(r,c){if(c&56){s=ke(r[3].wms);let l;for(l=0;l<s.length;l+=1){const u=xt(r,s,l);a[l]?a[l].p(u,c):(a[l]=Kt(u),a[l].c(),a[l].m(e,null))}for(;l<a.length;l+=1)a[l].d(1);a.length=s.length}},d(r){r&&C(e),ft(a,r)}}}function Wt(o){let e,t,n;return{c(){e=p("div"),t=x("ℹ️"),i(e,"class","layer-description svelte-5l43hf"),i(e,"title",n=o[13].description)},m(s,a){I(s,e,a),d(e,t)},p(s,a){a&8&&n!==(n=s[13].description)&&i(e,"title",n)},d(s){s&&C(e)}}}function Kt(o){let e,t,n,s,a,r,c,l,u=o[13].label+"",f,m,h,v,_;function $(){return o[11](o[13])}let g=o[13].description&&Wt(o);return{c(){e=p("div"),t=p("label"),n=p("input"),a=w(),r=p("span"),c=w(),l=p("span"),f=x(u),m=w(),g&&g.c(),h=w(),i(n,"type","checkbox"),n.checked=s=o[5](o[13].name),i(n,"class","svelte-5l43hf"),i(r,"class","checkmark svelte-5l43hf"),i(l,"class","layer-label svelte-5l43hf"),i(t,"class","layer-checkbox svelte-5l43hf"),i(e,"class","layer-item svelte-5l43hf")},m(k,b){I(k,e,b),d(e,t),d(t,n),d(t,a),d(t,r),d(t,c),d(t,l),d(l,f),d(e,m),g&&g.m(e,null),d(e,h),v||(_=O(n,"change",$),v=!0)},p(k,b){o=k,b&8&&s!==(s=o[5](o[13].name))&&(n.checked=s),b&8&&u!==(u=o[13].label+"")&&ee(f,u),o[13].description?g?g.p(o,b):(g=Wt(o),g.c(),g.m(e,h)):g&&(g.d(1),g=null)},d(k){k&&C(e),g&&g.d(),v=!1,_()}}}function Yt(o){let e;return{c(){e=p("div"),e.innerHTML='<p class="svelte-5l43hf">No layers available for this country</p>',i(e,"class","no-layers svelte-5l43hf")},m(t,n){I(t,e,n)},d(t){t&&C(e)}}}function Mn(o){let e,t=o[1]&&o[0].length>0&&Ot(o);return{c(){t&&t.c(),e=pt()},m(n,s){t&&t.m(n,s),I(n,e,s)},p(n,[s]){n[1]&&n[0].length>0?t?t.p(n,s):(t=Ot(n),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:U,o:U,d(n){n&&C(e),t&&t.d(n)}}}function xn(o){const e={point:[],shape:[],wms:[]};return o.forEach(t=>{e[t.type]&&e[t.type].push(t)}),Object.keys(e).forEach(t=>{e[t].sort((n,s)=>(n.order||10)-(s.order||10))}),e}function Un(o,e,t){let n,{availableLayers:s=[]}=e,{activeLayers:a=[]}=e,{isVisible:r=!0}=e;const c=ht();let l=!1;function u(g){c("toggle-layer",{layerName:g})}function f(g){return a.includes(g)}const m=()=>t(2,l=!l),h=g=>g.key==="Enter"&&t(2,l=!l),v=g=>u(g.name),_=g=>u(g.name),$=g=>u(g.name);return o.$$set=g=>{"availableLayers"in g&&t(0,s=g.availableLayers),"activeLayers"in g&&t(6,a=g.activeLayers),"isVisible"in g&&t(1,r=g.isVisible)},o.$$.update=()=>{o.$$.dirty&1&&t(3,n=xn(s))},[s,r,l,n,u,f,a,m,h,v,_,$]}class Rn extends qe{constructor(e){super(),Ge(this,e,Un,Mn,Me,{availableLayers:0,activeLayers:6,isVisible:1})}}function Qt(o){let e,t,n,s;function a(l,u){if(!l[2])return Vn;if(l[3])return On}let r=a(o),c=r&&r(o);return{c(){e=p("div"),t=p("div"),n=w(),s=p("div"),c&&c.c(),i(t,"class","spinner"),i(s,"class","loading-text svelte-1mk1qhk"),i(e,"class","loading-overlay svelte-1mk1qhk")},m(l,u){I(l,e,u),d(e,t),d(e,n),d(e,s),c&&c.m(s,null)},p(l,u){r===(r=a(l))&&c?c.p(l,u):(c&&c.d(1),c=r&&r(l),c&&(c.c(),c.m(s,null)))},d(l){l&&C(e),c&&c.d()}}}function On(o){let e,t,n;return{c(){e=x("Loading "),t=x(o[4]),n=x(" data...")},m(s,a){I(s,e,a),I(s,t,a),I(s,n,a)},p(s,a){a[0]&16&&ee(t,s[4])},d(s){s&&(C(e),C(t),C(n))}}}function Vn(o){let e;return{c(){e=x("Loading map...")},m(t,n){I(t,e,n)},p:U,d(t){t&&C(e)}}}function Xt(o){let e,t;return e=new Rn({props:{availableLayers:o[5],activeLayers:Array.from(o[6]),isVisible:!0}}),e.$on("toggle-layer",o[13]),{c(){Xe(e.$$.fragment)},m(n,s){ze(e,n,s),t=!0},p(n,s){const a={};s[0]&32&&(a.availableLayers=n[5]),s[0]&64&&(a.activeLayers=Array.from(n[6])),e.$set(a)},i(n){t||(K(e.$$.fragment,n),t=!0)},o(n){de(e.$$.fragment,n),t=!1},d(n){He(e,n)}}}function zn(o){let e,t,n,s,a=(!o[2]||o[3])&&Qt(o),r=o[2]&&o[5].length>0&&Xt(o);return{c(){e=p("div"),a&&a.c(),t=w(),r&&r.c(),i(e,"class","map-container svelte-1mk1qhk"),i(e,"role","application"),i(e,"aria-label",n="Interactive flood risk map for "+o[4])},m(c,l){I(c,e,l),a&&a.m(e,null),d(e,t),r&&r.m(e,null),o[14](e),s=!0},p(c,l){!c[2]||c[3]?a?a.p(c,l):(a=Qt(c),a.c(),a.m(e,t)):a&&(a.d(1),a=null),c[2]&&c[5].length>0?r?(r.p(c,l),l[0]&36&&K(r,1)):(r=Xt(c),r.c(),K(r,1),r.m(e,null)):r&&(Ye(),de(r,1,1,()=>{r=null}),Qe()),(!s||l[0]&16&&n!==(n="Interactive flood risk map for "+c[4]))&&i(e,"aria-label",n)},i(c){s||(K(r),s=!0)},o(c){de(r),s=!1},d(c){c&&C(e),a&&a.d(),r&&r.d(),o[14](null)}}}function Hn(o,e,t){const n=ht(),s=typeof window<"u";let a,r=null,c=null,l=null,u=new Map,f=!0,m=null,h=!1,v=new Map,_=null,$="IBF Dashboard",g=null,k=!1,b=[],E=new Set;gt(async()=>{s&&(await L(),setTimeout(async()=>{if(!_&&!k){k=!0;const y=ye(ve);y&&r?(console.log(`🗺️ Deferred initial country loading: ${y.name}`),_=y.countryCodeISO3,await z(y)):console.log(`🚫 Deferred loading blocked - country: ${!!y}, map: ${!!r}`)}else console.log("🔄 Skipping deferred loading - country already processed or loading already executed")},500),window.updateMapCountry=async y=>{if(!r||!y){console.log("🚫 Cannot update map - missing map or country");return}if(y.countryCodeISO3===_){console.log(`🔄 Ignoring duplicate country update: ${y.countryCodeISO3}`);return}console.log(`�️ Manual country update: ${y.name}`),await z(y)})}),vn(()=>{r&&(console.log("✅ Leaflet map being destroyed"),r.remove(),t(2,r=null))});async function L(){try{c=await Bt(()=>import("./leaflet-src-DTmlu4rB.js").then(y=>y.l),[]),t(2,r=c.map(a,{center:[9,40],zoom:5,zoomControl:!1,attributionControl:!0})),c.tileLayer("https://cartodb-basemaps-{s}.global.ssl.fastly.net/light_all/{z}/{x}/{y}.png",{attribution:'&copy; <a target="_blank" href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> &copy; <a target="_blank" href="https://carto.com/attributions">Carto</a>',maxZoom:18,subdomains:"abcd"}).addTo(r),c.control.zoom({position:"topleft"}).addTo(r),r.createPane("leaflet-ibf-wms-pane"),r.createPane("leaflet-ibf-admin-boundaries-pane"),r.createPane("leaflet-outline-pane"),r.createPane("leaflet-ibf-aggregate-pane"),r.createPane("leaflet-ibf-point-pane"),r.getPane("leaflet-ibf-wms-pane").style.zIndex="200",r.getPane("leaflet-ibf-admin-boundaries-pane").style.zIndex="300",r.getPane("leaflet-outline-pane").style.zIndex="400",r.getPane("leaflet-ibf-aggregate-pane").style.zIndex="500",r.getPane("leaflet-ibf-point-pane").style.zIndex="600",console.log("✅ Leaflet map initialized successfully"),f=!1}catch(y){console.error("❌ Error initializing map:",y),f=!1}}async function z(y){if(!r||!s||!y){console.log(`🚫 updateMapForCountry blocked - map: ${!!r}, browser: ${s}, country: ${!!y}`);return}if(g&&(console.log("⏳ Waiting for existing map update to complete..."),await g),y.countryCodeISO3===_){console.log(`🔄 Country ${y.name} already loaded - skipping`);return}return g=(async()=>{try{t(3,h=!0),console.log(`🗺️ Updating map for ${y.name} (${y.countryCodeISO3})`),m=y.countryCodeISO3,_=y.countryCodeISO3,t(4,$=y.name),l&&(r.removeLayer(l),l=null),y.coordinates&&r.setView([y.coordinates.lat,y.coordinates.lng],y.defaultZoom||6),J.useIbfApi&&(J.disableAuthentication||ye(Pe))?(await j(y.countryCodeISO3,y),await D(y.countryCodeISO3,"floods")):console.log("📝 IBF API not configured or not authenticated - skipping admin areas loading"),console.log(`✅ Map update completed for ${y.name}`)}catch(M){console.error("❌ Error updating map for country:",M)}finally{t(3,h=!1),g=null}})(),g}async function j(y,M){try{if(console.log(`📡 Loading admin areas for ${y} using authenticated API...`),v.has(y)){console.log(`✅ Using cached admin areas for ${y}`);const A=v.get(y);await S(A,y);return}const P=await Ce.getAdminAreas(y,2);P.status===200&&P.data&&P.data.features?(console.log(`✅ Loaded ${P.data.features.length} admin areas for ${y}`),v.set(y,P.data),await S(P.data,y)):P.status===403?console.log(`⚠️ Admin areas access restricted for ${y} - this is normal for limited user accounts`):console.log(`⚠️ No admin areas data available for ${y}`)}catch(P){console.error(`❌ Error loading admin areas for ${y}:`,P)}}async function S(y,M){if(!r){console.error("❌ Map not available for admin areas display - skipping");return}if(console.log("✅ Map is ready - proceeding with admin areas display"),l=(await Bt(()=>import("./leaflet-src-DTmlu4rB.js").then(A=>A.l),[])).geoJSON(y,{style:{color:"#00214d",weight:2,opacity:.8,fillColor:"#d6e0fa",fillOpacity:.2},pane:"leaflet-ibf-admin-boundaries-pane",onEachFeature:(A,T)=>{const F=A.properties,R=F.adm2_en||F.name||"Unknown District",q=F.adm1_en||F.region||"Unknown Region";T.bindPopup(`
          <div style="font-family: 'Open Sans', 'Helvetica Neue', sans-serif; color: #00214d;">
            <strong style="color: #00214d;">${R}</strong><br>
            <span style="color: #666;">${q}</span><br>
            <small style="color: #888;">District Code: ${F.adm2_pcode||"N/A"}</small>
          </div>
        `),T.on("mouseover",function(){this.setStyle({weight:3,fillOpacity:.5}),console.log("🔄 Admin area hovered:",A.properties.adm2_en),n("admin-area-hover",{area:A,countryCode:m})}),T.on("mouseout",function(){this.setStyle({weight:2,fillOpacity:.2}),console.log("🔄 Admin area hover cleared"),n("admin-area-hover-clear")})}}),!r){console.error("❌ Map became unavailable during layer creation");return}if(l.addTo(r),!r){console.error("❌ Map became unavailable after adding layer");return}l.getBounds().isValid()&&(r.fitBounds(l.getBounds(),{padding:[20,20]}),console.log("🎯 Map bounds fitted to admin areas"))}async function D(y,M){try{console.log(`🗂️ Loading layers for ${y} - ${M}`);const P=await at.getLayersForCountry(y,M);t(5,b=P);const A=new Set(E),T=A.size>0;if(u.forEach((F,R)=>{r&&r.hasLayer(F)&&r.removeLayer(F)}),u.clear(),!T)E.clear(),P.filter(F=>F.active).forEach(F=>{E.add(F.name)}),console.log(`🔄 Auto-activated ${E.size} default layers`);else{const F=new Set(P.map(R=>R.name));t(6,E=new Set([...A].filter(R=>F.has(R)))),console.log(`🔄 Preserved ${E.size} user layer preferences`)}E.forEach(F=>{const R=P.find(q=>q.name===F);R&&N(R,y,M)}),console.log(`✅ Loaded ${P.length} layers, ${E.size} active`)}catch(P){console.error("❌ Error loading country layers:",P)}}async function N(y,M,P,A){try{console.log(`🗺️ Loading layer data: ${y.name}`),u.has(y.name)&&(r.removeLayer(u.get(y.name)),u.delete(y.name));const T=await at.loadLayerData(y,M,P,A);if(!T||!T.features){console.log(`⚠️ No data available for layer: ${y.name}`);return}const F=c.layerGroup();T.features.forEach(R=>{if(R.geometry.type==="Point"){const q=at.createPointMarker(R,y.name,c);q.options.pane="leaflet-ibf-point-pane",F.addLayer(q)}}),F.addTo(r),u.set(y.name,F),console.log(`✅ Displayed ${T.features.length} points for layer: ${y.name}`)}catch(T){console.error(`❌ Error loading layer ${y.name}:`,T)}}function Y(y){if(m){if(E.has(y))E.delete(y),u.has(y)&&(r.removeLayer(u.get(y)),u.delete(y)),console.log(`🔄 Layer ${y} hidden`);else{E.add(y);const M=b.find(P=>P.name===y);M&&ye(ve)&&N(M,m,"floods"),console.log(`🔄 Layer ${y} shown`)}t(6,E=new Set(E))}}function W(){return{availableLayers:b,activeLayers:Array.from(E)}}function Q(y,M){r&&s&&r.setView([y,M],r.getZoom())}function G(y){r&&s&&r.setZoom(y)}function re(){r&&r.zoomIn()}function le(){r&&r.zoomOut()}function ge(){const y=ye(ve);r&&(y!=null&&y.coordinates)&&r.setView([y.coordinates.lat,y.coordinates.lng],y.defaultZoom||6)}const H=y=>Y(y.detail.layerName);function X(y){rt[y?"unshift":"push"](()=>{a=y,t(1,a)})}return[Y,a,r,h,$,b,E,W,Q,G,re,le,ge,H,X]}let Gn=class extends qe{constructor(e){super(),Ge(this,e,Hn,zn,Me,{toggleLayer:0,getLayerState:7,setCenter:8,setZoom:9,zoomIn:10,zoomOut:11,resetView:12},null,[-1,-1])}get toggleLayer(){return this.$$.ctx[0]}get getLayerState(){return this.$$.ctx[7]}get setCenter(){return this.$$.ctx[8]}get setZoom(){return this.$$.ctx[9]}get zoomIn(){return this.$$.ctx[10]}get zoomOut(){return this.$$.ctx[11]}get resetView(){return this.$$.ctx[12]}};function en(o){let e,t,n,s,a,r,c;return{c(){e=p("div"),t=oe("svg"),n=oe("circle"),s=oe("line"),a=oe("line"),r=w(),c=x(o[3]),i(n,"cx","12"),i(n,"cy","12"),i(n,"r","10"),i(s,"x1","15"),i(s,"y1","9"),i(s,"x2","9"),i(s,"y2","15"),i(a,"x1","9"),i(a,"y1","9"),i(a,"x2","15"),i(a,"y2","15"),i(t,"width","20"),i(t,"height","20"),i(t,"viewBox","0 0 24 24"),i(t,"fill","none"),i(t,"stroke","currentColor"),i(t,"stroke-width","2"),i(e,"class","error-message svelte-ourf9")},m(l,u){I(l,e,u),d(e,t),d(t,n),d(t,s),d(t,a),d(e,r),d(e,c)},p(l,u){u&8&&ee(c,l[3])},d(l){l&&C(e)}}}function qn(o){let e,t,n;return{c(){e=p("input"),i(e,"id","password"),i(e,"type","password"),i(e,"placeholder","Enter your password"),e.required=!0,e.disabled=o[4],i(e,"class","svelte-ourf9")},m(s,a){I(s,e,a),Ne(e,o[1]),t||(n=[O(e,"input",o[11]),O(e,"keydown",o[8])],t=!0)},p(s,a){a&16&&(e.disabled=s[4]),a&2&&e.value!==s[1]&&Ne(e,s[1])},d(s){s&&C(e),t=!1,se(n)}}}function jn(o){let e,t,n;return{c(){e=p("input"),i(e,"id","password"),i(e,"type","text"),i(e,"placeholder","Enter your password"),e.required=!0,e.disabled=o[4],i(e,"class","svelte-ourf9")},m(s,a){I(s,e,a),Ne(e,o[1]),t||(n=[O(e,"input",o[10]),O(e,"keydown",o[8])],t=!0)},p(s,a){a&16&&(e.disabled=s[4]),a&2&&e.value!==s[1]&&Ne(e,s[1])},d(s){s&&C(e),t=!1,se(n)}}}function Zn(o){let e,t,n;return{c(){e=oe("svg"),t=oe("path"),n=oe("circle"),i(t,"d","M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"),i(n,"cx","12"),i(n,"cy","12"),i(n,"r","3"),i(e,"width","20"),i(e,"height","20"),i(e,"viewBox","0 0 24 24"),i(e,"fill","none"),i(e,"stroke","currentColor"),i(e,"stroke-width","2")},m(s,a){I(s,e,a),d(e,t),d(e,n)},d(s){s&&C(e)}}}function Jn(o){let e,t,n;return{c(){e=oe("svg"),t=oe("path"),n=oe("line"),i(t,"d","M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"),i(n,"x1","1"),i(n,"y1","1"),i(n,"x2","23"),i(n,"y2","23"),i(e,"width","20"),i(e,"height","20"),i(e,"viewBox","0 0 24 24"),i(e,"fill","none"),i(e,"stroke","currentColor"),i(e,"stroke-width","2")},m(s,a){I(s,e,a),d(e,t),d(e,n)},d(s){s&&C(e)}}}function Wn(o){let e;return{c(){e=x("Sign In")},m(t,n){I(t,e,n)},d(t){t&&C(e)}}}function Kn(o){let e,t,n;return{c(){e=oe("svg"),t=oe("path"),n=x(`\r
            Signing in...`),i(t,"d","M21 12a9 9 0 11-6.219-8.56"),i(e,"class","spinner svelte-ourf9"),i(e,"width","20"),i(e,"height","20"),i(e,"viewBox","0 0 24 24"),i(e,"fill","none"),i(e,"stroke","currentColor"),i(e,"stroke-width","2")},m(s,a){I(s,e,a),d(e,t),I(s,n,a)},d(s){s&&(C(e),C(n))}}}function Yn(o){let e,t,n,s,a,r,c,l,u,f,m,h,v,_,$,g,k,b,E,L,z,j,S,D,N,Y,W,Q,G,re,le,ge,H=o[3]&&en(o);function X(B,Z){return B[2]?jn:qn}let y=X(o),M=y(o);function P(B,Z){return B[2]?Jn:Zn}let A=P(o),T=A(o);function F(B,Z){return B[4]?Kn:Wn}let R=F(o),q=R(o);return{c(){e=p("div"),t=p("div"),n=p("div"),s=p("h2"),s.textContent="Sign in to IBF Dashboard",a=w(),r=p("button"),r.innerHTML='<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>',c=w(),H&&H.c(),l=w(),u=p("form"),f=p("div"),m=p("label"),m.textContent="Email Address",h=w(),v=p("input"),_=w(),$=p("div"),g=p("label"),g.textContent="Password",k=w(),b=p("div"),M.c(),E=w(),L=p("button"),T.c(),j=w(),S=p("div"),D=p("button"),N=x("Cancel"),Y=w(),W=p("button"),q.c(),G=w(),re=p("div"),re.innerHTML=`<p class="svelte-ourf9"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><circle cx="12" cy="16" r="1"></circle><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg>
        Secure authentication via IBF API</p>`,i(s,"class","svelte-ourf9"),i(r,"class","close-btn svelte-ourf9"),i(r,"aria-label","Close"),i(n,"class","popup-header svelte-ourf9"),i(m,"for","email"),i(m,"class","svelte-ourf9"),i(v,"id","email"),i(v,"type","email"),i(v,"placeholder","Enter your IBF account email"),v.required=!0,v.disabled=o[4],i(v,"class","svelte-ourf9"),i(f,"class","form-group svelte-ourf9"),i(g,"for","password"),i(g,"class","svelte-ourf9"),i(L,"type","button"),i(L,"class","password-toggle svelte-ourf9"),L.disabled=o[4],i(L,"aria-label",z=o[2]?"Hide password":"Show password"),i(b,"class","password-input svelte-ourf9"),i($,"class","form-group svelte-ourf9"),i(D,"type","button"),i(D,"class","btn btn-secondary svelte-ourf9"),D.disabled=o[4],i(W,"type","submit"),i(W,"class","btn btn-primary svelte-ourf9"),W.disabled=Q=o[4]||!o[0]||!o[1],i(S,"class","form-actions svelte-ourf9"),i(u,"class","login-form svelte-ourf9"),i(re,"class","popup-footer svelte-ourf9"),i(t,"class","login-popup svelte-ourf9"),i(t,"role","dialog"),i(e,"class","login-overlay svelte-ourf9"),i(e,"role","dialog"),i(e,"tabindex","-1")},m(B,Z){I(B,e,Z),d(e,t),d(t,n),d(n,s),d(n,a),d(n,r),d(t,c),H&&H.m(t,null),d(t,l),d(t,u),d(u,f),d(f,m),d(f,h),d(f,v),Ne(v,o[0]),d(u,_),d(u,$),d($,g),d($,k),d($,b),M.m(b,null),d(b,E),d(b,L),T.m(L,null),d(u,j),d(u,S),d(S,D),d(D,N),d(S,Y),d(S,W),q.m(W,null),d(t,G),d(t,re),le||(ge=[O(r,"click",o[6]),O(v,"input",o[9]),O(v,"keydown",o[8]),O(L,"click",o[7]),O(D,"click",o[6]),O(u,"submit",mn(o[5])),O(t,"click",Qn),O(e,"click",o[6]),O(e,"keydown",o[12])],le=!0)},p(B,[Z]){B[3]?H?H.p(B,Z):(H=en(B),H.c(),H.m(t,l)):H&&(H.d(1),H=null),Z&16&&(v.disabled=B[4]),Z&1&&v.value!==B[0]&&Ne(v,B[0]),y===(y=X(B))&&M?M.p(B,Z):(M.d(1),M=y(B),M&&(M.c(),M.m(b,E))),A!==(A=P(B))&&(T.d(1),T=A(B),T&&(T.c(),T.m(L,null))),Z&16&&(L.disabled=B[4]),Z&4&&z!==(z=B[2]?"Hide password":"Show password")&&i(L,"aria-label",z),Z&16&&(D.disabled=B[4]),R!==(R=F(B))&&(q.d(1),q=R(B),q&&(q.c(),q.m(W,null))),Z&19&&Q!==(Q=B[4]||!B[0]||!B[1])&&(W.disabled=Q)},i:U,o:U,d(B){B&&C(e),H&&H.d(),M.d(),T.d(),q.d(),le=!1,se(ge)}}}const Qn=o=>o.stopPropagation();function Xn(o,e,t){let n,s;Ke(o,ue,k=>t(3,n=k)),Ke(o,ct,k=>t(4,s=k));const a=ht();let r="",c="",l=!1;async function u(){if(!r||!c)return;await Ve.loginWithIBF(r,c)&&a("login-success")}function f(){a("close")}function m(){t(2,l=!l)}function h(k){k.key==="Enter"&&u()}function v(){r=this.value,t(0,r)}function _(){c=this.value,t(1,c)}function $(){c=this.value,t(1,c)}return[r,c,l,n,s,u,f,m,h,v,_,$,k=>k.key==="Escape"&&f()]}class eo extends qe{constructor(e){super(),Ge(this,e,Xn,Yn,Me,{})}}function to(o){let e;return{c(){e=p("div"),e.innerHTML='<h3 class="svelte-mi8xx6">National View</h3> <p class="svelte-mi8xx6">Hover over an admin area to see statistics</p>',i(e,"class","national-view-default svelte-mi8xx6")},m(t,n){I(t,e,n)},p:U,d(t){t&&C(e)}}}function no(o){let e,t,n=(o[0].properties.adm2_en||o[0].properties.name||"Unknown Area")+"",s,a,r,c=(o[0].properties.adm1_en||"Unknown Region")+"",l,u,f;function m(_,$){return _[2]?ro:_[3]?ao:_[1]?so:oo}let h=m(o),v=h(o);return{c(){e=p("div"),t=p("h3"),s=x(n),a=w(),r=p("h4"),l=x(c),u=w(),f=p("div"),v.c(),i(t,"class","svelte-mi8xx6"),i(r,"class","svelte-mi8xx6"),i(e,"class","admin-area-header svelte-mi8xx6"),i(f,"class","admin-area-stats svelte-mi8xx6")},m(_,$){I(_,e,$),d(e,t),d(t,s),d(e,a),d(e,r),d(r,l),I(_,u,$),I(_,f,$),v.m(f,null)},p(_,$){$&1&&n!==(n=(_[0].properties.adm2_en||_[0].properties.name||"Unknown Area")+"")&&ee(s,n),$&1&&c!==(c=(_[0].properties.adm1_en||"Unknown Region")+"")&&ee(l,c),h===(h=m(_))&&v?v.p(_,$):(v.d(1),v=h(_),v&&(v.c(),v.m(f,null)))},d(_){_&&(C(e),C(u),C(f)),v.d()}}}function oo(o){let e;return{c(){e=p("div"),e.textContent="No data available for this area",i(e,"class","no-data-message svelte-mi8xx6")},m(t,n){I(t,e,n)},p:U,d(t){t&&C(e)}}}function so(o){let e,t,n,s,a,r,c,l=Ze(o[1].exposedPopulation||0)+"",u,f,m,h,v,_,$,g,k,b,E,L=Ze(o[1].totalPopulation||0)+"",z,j,S;return{c(){e=p("div"),t=p("div"),t.innerHTML='<svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"></path></svg>',n=w(),s=p("div"),a=p("div"),a.textContent="Exposed population",r=w(),c=p("div"),u=x(l),f=w(),m=p("button"),m.textContent="ℹ️",h=w(),v=p("div"),_=p("div"),_.innerHTML='<svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"></path></svg>',$=w(),g=p("div"),k=p("div"),k.textContent="Total population",b=w(),E=p("div"),z=x(L),j=w(),S=p("button"),S.textContent="ℹ️",i(t,"class","stat-icon svelte-mi8xx6"),i(a,"class","stat-label svelte-mi8xx6"),i(c,"class","stat-value svelte-mi8xx6"),i(s,"class","stat-info svelte-mi8xx6"),i(m,"class","stat-info-btn svelte-mi8xx6"),i(e,"class","stat-item svelte-mi8xx6"),i(_,"class","stat-icon svelte-mi8xx6"),i(k,"class","stat-label svelte-mi8xx6"),i(E,"class","stat-value svelte-mi8xx6"),i(g,"class","stat-info svelte-mi8xx6"),i(S,"class","stat-info-btn svelte-mi8xx6"),i(v,"class","stat-item svelte-mi8xx6")},m(D,N){I(D,e,N),d(e,t),d(e,n),d(e,s),d(s,a),d(s,r),d(s,c),d(c,u),d(e,f),d(e,m),I(D,h,N),I(D,v,N),d(v,_),d(v,$),d(v,g),d(g,k),d(g,b),d(g,E),d(E,z),d(v,j),d(v,S)},p(D,N){N&2&&l!==(l=Ze(D[1].exposedPopulation||0)+"")&&ee(u,l),N&2&&L!==(L=Ze(D[1].totalPopulation||0)+"")&&ee(z,L)},d(D){D&&(C(e),C(h),C(v))}}}function ao(o){let e;return{c(){e=p("div"),e.textContent="Error loading data",i(e,"class","error-message svelte-mi8xx6")},m(t,n){I(t,e,n)},p:U,d(t){t&&C(e)}}}function ro(o){let e;return{c(){e=p("div"),e.textContent="Loading population data...",i(e,"class","loading-message svelte-mi8xx6")},m(t,n){I(t,e,n)},p:U,d(t){t&&C(e)}}}function lo(o){let e;function t(a,r){return a[0]?no:to}let n=t(o),s=n(o);return{c(){s.c(),e=pt()},m(a,r){s.m(a,r),I(a,e,r)},p(a,[r]){n===(n=t(a))&&s?s.p(a,r):(s.d(1),s=n(a),s&&(s.c(),s.m(e.parentNode,e)))},i:U,o:U,d(a){a&&C(e),s.d(a)}}}function Ze(o){if(!o&&o!==0)return"N/A";const e=typeof o=="string"?parseFloat(o):o;return isNaN(e)?"N/A":e.toLocaleString()}function io(o,e,t){let{selectedArea:n=null}=e,{countryCode:s=""}=e,a=null,r=!1,c=null;async function l(){if(!(!n||!s)){t(2,r=!0),t(3,c=null),t(1,a=null);try{console.log("📊 Loading population data for area:",n.properties);const u=n.properties.adm2_pcode||n.properties.placeCode;if(!u){console.log("⚠️ No admin code found for area");return}const f=await Ce.getAggregatedData(s,"floods",u,2);f.data?(t(1,a=f.data),console.log("✅ Population data loaded:",a)):(t(1,a={exposedPopulation:n.properties.population||0,totalPopulation:n.properties.population||0}),console.log("📋 Using fallback population data:",a))}catch(u){console.error("❌ Error loading population data:",u),t(3,c="Failed to load population data"),t(1,a={exposedPopulation:n.properties.population||0,totalPopulation:n.properties.population||0})}finally{t(2,r=!1)}}}return gt(()=>{console.log("🚀 AdminAreaInfo component mounted"),console.log("📊 Initial state:",{selectedArea:n,countryCode:s})}),o.$$set=u=>{"selectedArea"in u&&t(0,n=u.selectedArea),"countryCode"in u&&t(4,s=u.countryCode)},o.$$.update=()=>{var u;o.$$.dirty&17&&(console.log("🔄 AdminAreaInfo: Reactive update triggered"),console.log("📊 Current state:",{selectedArea:!!n,countryCode:s}),n&&s?(console.log("✅ AdminAreaInfo: Conditions met, loading data...",{areaName:(u=n.properties)==null?void 0:u.adm2_en,countryCode:s}),l()):console.log("❌ AdminAreaInfo: Conditions not met",{hasSelectedArea:!!n,hasCountryCode:!!s}))},[n,a,r,c,s]}class co extends qe{constructor(e){super(),Ge(this,e,io,lo,Me,{selectedArea:0,countryCode:4})}}const{Map:uo}=pn;function tn(o,e,t){const n=o.slice();return n[40]=e[t],n}function fo(o){var Ct;let e,t,n,s,a,r,c,l,u=(((Ct=o[7])==null?void 0:Ct.toUpperCase())||"LOADING")+"",f,m,h=o[2].toUpperCase()+"",v,_,$,g,k,b,E,L,z,j,S,D,N,Y,W,Q,G,re,le,ge,H,X,y,M,P,A,T,F,R,q,B,Z,_t,Ie,je,bt,Le,xe,ie,fe,wt,Ae,_e,kt,he,et,At,te=o[3]&&nn(o),ne=o[4]&&sn(o);const Et=[ho,go],be=[];function $t(V,ce){return V[5]?0:1}ie=$t(o),fe=be[ie]=Et[ie](o),_e=new Gn({}),_e.$on("admin-area-hover",o[14]),_e.$on("admin-area-hover-clear",o[15]);let ae=o[12]&&an();return{c(){e=p("div"),t=p("header"),n=p("div"),s=p("div"),a=p("button"),a.innerHTML='<svg width="18" height="18" viewBox="0 0 18 18" fill="currentColor"><circle cx="3" cy="3" r="1.5"></circle><circle cx="9" cy="3" r="1.5"></circle><circle cx="15" cy="3" r="1.5"></circle><circle cx="3" cy="9" r="1.5"></circle><circle cx="9" cy="9" r="1.5"></circle><circle cx="15" cy="9" r="1.5"></circle><circle cx="3" cy="15" r="1.5"></circle><circle cx="9" cy="15" r="1.5"></circle><circle cx="15" cy="15" r="1.5"></circle></svg>',r=w(),c=p("h1"),l=x("IBF PORTAL "),f=x(u),m=w(),v=x(h),_=x(" NON-TRIGGERED"),$=w(),g=p("div"),k=p("div"),k.innerHTML='<div class="red-cross-icon svelte-rfxf3s">+</div>',b=w(),E=p("div"),L=p("span"),L.textContent="Logged in as:",z=w(),j=p("span"),S=x(o[10]),D=w(),N=p("button"),N.textContent="Log out",Y=w(),te&&te.c(),W=w(),Q=p("div"),G=p("aside"),ne&&ne.c(),re=w(),le=p("div"),le.innerHTML='<div class="current-date svelte-rfxf3s"><div class="date-icon svelte-rfxf3s">📅</div> <div class="date-info"><div class="date-main svelte-rfxf3s">16 Jul 2025</div> <div class="date-sub svelte-rfxf3s">Wednesday, 22:41 GMT+2</div></div></div>',ge=w(),H=p("div"),X=p("p"),y=x("Hello "),M=p("strong"),P=x(o[10]),A=x(`. The information in this portal is \r
            based on the model last run on `),T=p("strong"),T.textContent="Monday, 16 June 09:08",F=x("."),R=w(),q=p("div"),q.innerHTML='<div class="button-row svelte-rfxf3s"><button class="action-btn active svelte-rfxf3s">About trigger</button> <button class="action-btn svelte-rfxf3s">Alert log</button></div> <div class="button-row svelte-rfxf3s"><button class="action-btn svelte-rfxf3s">IBF guide</button> <button class="action-btn svelte-rfxf3s">Export view</button></div>',B=w(),Z=p("div"),Z.innerHTML=`<p class="info-text svelte-rfxf3s">To your right is the map of your country. You can turn 
            data layers on and off. There are currently <strong>no alerts</strong> 
            issued.</p>`,_t=w(),Ie=p("main"),je=p("div"),je.innerHTML='<div class="timeline-nav svelte-rfxf3s"><button class="timeline-btn svelte-rfxf3s">Jun 2025</button> <button class="timeline-btn active svelte-rfxf3s">Jul 2025</button> <button class="timeline-btn svelte-rfxf3s">Aug 2025</button> <button class="timeline-btn svelte-rfxf3s">Sep 2025</button> <button class="timeline-btn svelte-rfxf3s">Oct 2025</button> <button class="timeline-btn svelte-rfxf3s">Nov 2025</button> <button class="timeline-btn svelte-rfxf3s">Dec 2025</button> <button class="timeline-btn svelte-rfxf3s">Jan 2026</button> <button class="timeline-btn svelte-rfxf3s">Feb 2026</button> <button class="timeline-btn svelte-rfxf3s">Mar 2026</button> <button class="timeline-btn svelte-rfxf3s">Apr 2026</button> <button class="timeline-btn svelte-rfxf3s">May 2026</button> <button class="info-icon svelte-rfxf3s">ℹ️</button></div>',bt=w(),Le=p("div"),xe=p("div"),fe.c(),wt=w(),Ae=p("div"),Xe(_e.$$.fragment),kt=w(),ae&&ae.c(),i(a,"class","menu-toggle svelte-rfxf3s"),i(s,"class","header-menu"),i(c,"class","portal-title svelte-rfxf3s"),i(n,"class","header-left svelte-rfxf3s"),i(k,"class","red-cross-logo svelte-rfxf3s"),i(L,"class","user-label svelte-rfxf3s"),i(j,"class","user-name svelte-rfxf3s"),i(N,"class","logout-btn svelte-rfxf3s"),i(E,"class","user-section svelte-rfxf3s"),i(g,"class","header-right svelte-rfxf3s"),i(t,"class","portal-header svelte-rfxf3s"),i(le,"class","date-section svelte-rfxf3s"),i(X,"class","greeting-text svelte-rfxf3s"),i(H,"class","greeting-section svelte-rfxf3s"),i(q,"class","action-buttons svelte-rfxf3s"),i(Z,"class","info-section svelte-rfxf3s"),i(G,"class","portal-sidebar svelte-rfxf3s"),we(G,"mobile-hidden",!o[4]),i(je,"class","timeline-header svelte-rfxf3s"),i(xe,"class","national-view-column svelte-rfxf3s"),i(Ae,"class","map-container"),i(Le,"class","main-content-columns svelte-rfxf3s"),i(Ie,"class","portal-main svelte-rfxf3s"),i(Q,"class","portal-content svelte-rfxf3s"),i(e,"class","ibf-portal svelte-rfxf3s")},m(V,ce){I(V,e,ce),d(e,t),d(t,n),d(n,s),d(s,a),d(n,r),d(n,c),d(c,l),d(c,f),d(c,m),d(c,v),d(c,_),d(t,$),d(t,g),d(g,k),d(g,b),d(g,E),d(E,L),d(E,z),d(E,j),d(j,S),d(E,D),d(E,N),d(e,Y),te&&te.m(e,null),d(e,W),d(e,Q),d(Q,G),ne&&ne.m(G,null),d(G,re),d(G,le),d(G,ge),d(G,H),d(H,X),d(X,y),d(X,M),d(M,P),d(X,A),d(X,T),d(X,F),d(G,R),d(G,q),d(G,B),d(G,Z),d(Q,_t),d(Q,Ie),d(Ie,je),d(Ie,bt),d(Ie,Le),d(Le,xe),be[ie].m(xe,null),d(Le,wt),d(Le,Ae),ze(_e,Ae,null),d(Ae,kt),ae&&ae.m(Ae,null),he=!0,et||(At=[O(a,"click",o[16]),O(N,"click",o[19])],et=!0)},p(V,ce){var It;(!he||ce[0]&128)&&u!==(u=(((It=V[7])==null?void 0:It.toUpperCase())||"LOADING")+"")&&ee(f,u),(!he||ce[0]&4)&&h!==(h=V[2].toUpperCase()+"")&&ee(v,h),(!he||ce[0]&1024)&&ee(S,V[10]),V[3]?te?te.p(V,ce):(te=nn(V),te.c(),te.m(e,W)):te&&(te.d(1),te=null),V[4]?ne?ne.p(V,ce):(ne=sn(V),ne.c(),ne.m(G,re)):ne&&(ne.d(1),ne=null),(!he||ce[0]&1024)&&ee(P,V[10]),(!he||ce[0]&16)&&we(G,"mobile-hidden",!V[4]);let tt=ie;ie=$t(V),ie===tt?be[ie].p(V,ce):(Ye(),de(be[tt],1,1,()=>{be[tt]=null}),Qe(),fe=be[ie],fe?fe.p(V,ce):(fe=be[ie]=Et[ie](V),fe.c()),K(fe,1),fe.m(xe,null)),V[12]?ae||(ae=an(),ae.c(),ae.m(Ae,null)):ae&&(ae.d(1),ae=null)},i(V){he||(K(fe),K(_e.$$.fragment,V),he=!0)},o(V){de(fe),de(_e.$$.fragment,V),he=!1},d(V){V&&C(e),te&&te.d(),ne&&ne.d(),be[ie].d(),He(_e),ae&&ae.d(),et=!1,se(At)}}}function po(o){let e,t,n,s,a,r,c,l,u,f,m,h;return{c(){e=p("div"),t=p("div"),n=p("div"),n.innerHTML='<h1 class="svelte-rfxf3s">IBF Dashboard</h1> <p class="svelte-rfxf3s">Impact-Based Forecasting for Early Action</p>',s=w(),a=p("div"),r=p("p"),r.textContent="Please sign in with your IBF account to access the dashboard.",c=w(),l=p("button"),l.textContent="Sign in to IBF Dashboard",u=w(),f=p("div"),f.innerHTML='<p class="svelte-rfxf3s">This system is for authorized Red Cross personnel only.</p>',i(n,"class","auth-header svelte-rfxf3s"),i(r,"class","svelte-rfxf3s"),i(l,"class","btn btn-primary svelte-rfxf3s"),i(a,"class","auth-content svelte-rfxf3s"),i(f,"class","auth-footer svelte-rfxf3s"),i(t,"class","auth-card svelte-rfxf3s"),i(e,"class","auth-container svelte-rfxf3s")},m(v,_){I(v,e,_),d(e,t),d(t,n),d(t,s),d(t,a),d(a,r),d(a,c),d(a,l),d(t,u),d(t,f),m||(h=O(l,"click",o[18]),m=!0)},p:U,i:U,o:U,d(v){v&&C(e),m=!1,h()}}}function mo(o){let e;return{c(){e=p("div"),e.innerHTML='<div class="spinner svelte-rfxf3s"></div> <div class="loading-text svelte-rfxf3s">Initializing IBF Dashboard...</div>',i(e,"class","loading svelte-rfxf3s")},m(t,n){I(t,e,n)},p:U,i:U,o:U,d(t){t&&C(e)}}}function nn(o){let e,t,n,s,a,r,c,l,u,f,m,h=[],v=new uo,_,$,g=ke(o[8]);const k=b=>b[40].countryCodeISO3;for(let b=0;b<g.length;b+=1){let E=tn(o,g,b),L=k(E);v.set(L,h[b]=on(L,E))}return{c(){e=p("div"),t=p("div"),n=p("h3"),n.textContent="Menu",s=w(),a=p("div"),r=p("button"),r.innerHTML='<div class="menu-option-icon svelte-rfxf3s">📋</div> <div class="menu-option-info svelte-rfxf3s"><div class="menu-option-name svelte-rfxf3s">Dashboard Info</div> <div class="menu-option-desc svelte-rfxf3s">Date, actions &amp; controls</div></div>',c=w(),l=p("div"),u=p("h4"),u.textContent="Select Country",f=w(),m=p("div");for(let b=0;b<h.length;b+=1)h[b].c();i(n,"class","svelte-rfxf3s"),i(r,"class","menu-option sidebar-option svelte-rfxf3s"),i(r,"role","menuitem"),i(a,"class","mobile-menu-section svelte-rfxf3s"),i(u,"class","svelte-rfxf3s"),i(m,"class","country-list svelte-rfxf3s"),i(l,"class","country-section svelte-rfxf3s"),i(t,"class","country-selector-dropdown svelte-rfxf3s"),i(t,"role","menu"),i(t,"tabindex","0"),i(t,"aria-label","Country selection menu"),i(e,"class","country-selector-overlay svelte-rfxf3s"),i(e,"role","button"),i(e,"tabindex","0"),i(e,"aria-label","Close country selector")},m(b,E){I(b,e,E),d(e,t),d(t,n),d(t,s),d(t,a),d(a,r),d(t,c),d(t,l),d(l,u),d(l,f),d(l,m);for(let L=0;L<h.length;L+=1)h[L]&&h[L].m(m,null);_||($=[O(r,"click",o[17]),O(t,"click",Tt(o[23])),O(t,"keydown",Tt(o[24])),O(e,"click",o[26]),O(e,"keydown",o[27])],_=!0)},p(b,E){E[0]&8960&&(g=ke(b[8]),h=An(h,E,k,1,b,g,v,m,kn,on,null,tn))},d(b){b&&C(e);for(let E=0;E<h.length;E+=1)h[E].d();_=!1,se($)}}}function on(o,e){let t,n,s,a,r,c=e[40].name+"",l,u,f,m=e[40].region+"",h,v,_,$;function g(){return e[25](e[40])}return{key:o,first:null,c(){var k;t=p("button"),n=p("div"),n.textContent="🌍",s=w(),a=p("div"),r=p("div"),l=x(c),u=w(),f=p("div"),h=x(m),v=w(),i(n,"class","country-flag svelte-rfxf3s"),i(r,"class","country-name svelte-rfxf3s"),i(f,"class","country-region svelte-rfxf3s"),i(a,"class","country-info svelte-rfxf3s"),i(t,"class","country-item svelte-rfxf3s"),i(t,"role","menuitem"),we(t,"active",((k=e[9])==null?void 0:k.countryCodeISO3)===e[40].countryCodeISO3),this.first=t},m(k,b){I(k,t,b),d(t,n),d(t,s),d(t,a),d(a,r),d(r,l),d(a,u),d(a,f),d(f,h),d(t,v),_||($=O(t,"click",g),_=!0)},p(k,b){var E;e=k,b[0]&256&&c!==(c=e[40].name+"")&&ee(l,c),b[0]&256&&m!==(m=e[40].region+"")&&ee(h,m),b[0]&768&&we(t,"active",((E=e[9])==null?void 0:E.countryCodeISO3)===e[40].countryCodeISO3)},d(k){k&&C(t),_=!1,$()}}}function sn(o){let e,t,n;return{c(){e=p("div"),i(e,"class","mobile-sidebar-overlay svelte-rfxf3s"),i(e,"role","button"),i(e,"tabindex","0"),i(e,"aria-label","Close sidebar")},m(s,a){I(s,e,a),t||(n=[O(e,"click",o[28]),O(e,"keydown",o[29])],t=!0)},p:U,d(s){s&&C(e),t=!1,se(n)}}}function go(o){let e,t,n;return{c(){e=p("div"),e.innerHTML='<h3 class="svelte-rfxf3s">National View</h3> <h4 class="svelte-rfxf3s">Predicted Drought</h4>',t=w(),n=p("div"),n.innerHTML='<div class="stat-item svelte-rfxf3s"><div class="stat-icon svelte-rfxf3s"><svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"></path></svg></div> <div class="stat-info svelte-rfxf3s"><div class="stat-label svelte-rfxf3s">Exposed population</div> <div class="stat-value svelte-rfxf3s">0</div></div> <button class="stat-info-btn svelte-rfxf3s">ℹ️</button></div> <div class="stat-item svelte-rfxf3s"><div class="stat-icon svelte-rfxf3s"><svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M16 4c0-1.11.89-2 2-2s2 .89 2 2-.89 2-2 2-2-.89-2-2zm4 18v-6h2.5l-2.54-7.63A3.002 3.002 0 0 0 17.09 7c-.6 0-1.13.27-1.49.69L14.5 9.5l1.41 1.41L17 9.83V22h3zM12.5 11.5c.83 0 1.5-.67 1.5-1.5s-.67-1.5-1.5-1.5S11 9.17 11 10s.67 1.5 1.5 1.5zm1.5 1h-3C9.57 12.5 8.5 13.57 8.5 15v7h7v-7c0-1.43-1.07-2.5-2.5-2.5zM5.5 6c1.11 0 2-.89 2-2s-.89-2-2-2-2 .89-2 2 .89 2 2 2zm2 16v-7H9V9.5C9 8.57 8.43 8 7.5 8S6 8.57 6 9.5V15H7.5v7h0z"></path></svg></div> <div class="stat-info svelte-rfxf3s"><div class="stat-label svelte-rfxf3s">Total Population</div> <div class="stat-value svelte-rfxf3s">0</div></div> <button class="stat-info-btn svelte-rfxf3s">ℹ️</button></div>',i(e,"class","national-view-header svelte-rfxf3s"),i(n,"class","national-view-stats svelte-rfxf3s")},m(s,a){I(s,e,a),I(s,t,a),I(s,n,a)},p:U,i:U,o:U,d(s){s&&(C(e),C(t),C(n))}}}function ho(o){let e,t;return e=new co({props:{selectedArea:o[5],countryCode:o[6]}}),{c(){Xe(e.$$.fragment)},m(n,s){ze(e,n,s),t=!0},p(n,s){const a={};s[0]&32&&(a.selectedArea=n[5]),s[0]&64&&(a.countryCode=n[6]),e.$set(a)},i(n){t||(K(e.$$.fragment,n),t=!0)},o(n){de(e.$$.fragment,n),t=!1},d(n){He(e,n)}}}function an(o){let e;return{c(){e=p("div"),e.innerHTML='<div class="spinner svelte-rfxf3s"></div> <div class="loading-text svelte-rfxf3s">Loading initial data...</div>',i(e,"class","loading-overlay svelte-rfxf3s")},m(t,n){I(t,e,n)},d(t){t&&C(e)}}}function rn(o){let e,t;return e=new eo({}),e.$on("login-success",o[20]),e.$on("close",o[21]),{c(){Xe(e.$$.fragment)},m(n,s){ze(e,n,s),t=!0},p:U,i(n){t||(K(e.$$.fragment,n),t=!0)},o(n){de(e.$$.fragment,n),t=!1},d(n){He(e,n)}}}function vo(o){let e,t,n,s,a;const r=[mo,po,fo],c=[];function l(f,m){return f[1]?0:!f[11]&&!J.disableAuthentication?1:2}e=l(o),t=c[e]=r[e](o);let u=o[0]&&rn(o);return{c(){t.c(),n=w(),u&&u.c(),s=pt()},m(f,m){c[e].m(f,m),I(f,n,m),u&&u.m(f,m),I(f,s,m),a=!0},p(f,m){let h=e;e=l(f),e===h?c[e].p(f,m):(Ye(),de(c[h],1,1,()=>{c[h]=null}),Qe(),t=c[e],t?t.p(f,m):(t=c[e]=r[e](f),t.c()),K(t,1),t.m(n.parentNode,n)),f[0]?u?(u.p(f,m),m[0]&1&&K(u,1)):(u=rn(f),u.c(),K(u,1),u.m(s.parentNode,s)):u&&(Ye(),de(u,1,1,()=>{u=null}),Qe())},i(f){a||(K(t),K(u),a=!0)},o(f){de(t),de(u),a=!1},d(f){f&&(C(n),C(s)),c[e].d(f),u&&u.d(f)}}}function yo(o){return{ETH:"East Africa",KEN:"East Africa",UGA:"East Africa",PHL:"Southeast Asia",BGD:"South Asia",NPL:"South Asia",MLI:"West Africa",ZMB:"Southern Africa",MWI:"Southern Africa",ECU:"South America",PER:"South America"}[o]||"Unknown Region"}function _o(o){return{ETH:{lat:9.145,lng:40.4897},KEN:{lat:-.0236,lng:37.9062},UGA:{lat:1.3733,lng:32.2903},PHL:{lat:12.8797,lng:121.774},BGD:{lat:23.685,lng:90.3563},NPL:{lat:28.3949,lng:84.124},MLI:{lat:17.5707,lng:-3.9962},ZMB:{lat:-13.1339,lng:27.8493},MWI:{lat:-13.2543,lng:34.3015},ECU:{lat:-1.8312,lng:-78.1834},PER:{lat:-9.19,lng:-75.0152}}[o]||{lat:0,lng:0}}function bo(o){return{ETH:[[3,33],[15,48]],KEN:[[-5,34],[6,42]],UGA:[[-1.5,29.5],[4.5,35]],PHL:[[4.5,116],[21,127]],BGD:[[20.5,88],[26.5,93]],NPL:[[26.3,80],[30.4,88.2]],MLI:[[10,-12],[25,5]],ZMB:[[-18,22],[-8,34]],MWI:[[-17,33],[-9,36]],ECU:[[-5,-82],[2,-75]],PER:[[-18.5,-82],[0,-68]]}[o]||[[-90,-180],[90,180]]}function wo(o,e,t){let n,s,a;Ke(o,Pe,A=>t(22,s=A)),Ke(o,We,A=>t(12,a=A));const r=typeof window<"u";let c=!1,l=!0,u="drought";new Date().toISOString().split("T")[0];let f=!1,m=!1,h=null,v="",_="LOADING",$=[],g=null,k="Henry Dunant";function b(){const A=ye(ve),T=ye(st),F=ye(Fe);t(7,_=(A==null?void 0:A.name)||"LOADING"),t(8,$=T||[]),t(9,g=A),t(10,k=(F==null?void 0:F.name)||"User")}gt(async()=>{if(r){await E();const A=()=>{window.innerWidth>=768||t(3,f=!1),t(4,m=!1)};return window.addEventListener("resize",A),()=>{window.removeEventListener("resize",A)}}});async function E(){try{t(1,l=!0),J.disableAuthentication||await Ve.initializeFromParent(),b(),await L()}catch(A){console.error("Error initializing app:",A)}finally{t(1,l=!1)}}async function L(){We.set(!0);try{if(J.useIbfApi){console.log("📡 Loading data from IBF API...");const A=await Ce.getCountries();if(A.data){console.log("✅ Countries loaded from IBF API:",A.data.length);const T=A.data.map(R=>({countryCodeISO3:R.countryCodeISO3,countryName:R.countryName,name:R.countryName,region:yo(R.countryCodeISO3),coordinates:_o(R.countryCodeISO3),defaultZoom:6,population:null,countryBounds:R.countryBounds||bo(R.countryCodeISO3)}));st.set(T),b();const F=T.find(R=>R.countryCodeISO3==="ETH");F?(ve.set(F),b(),console.log("🇪🇹 Selected Ethiopia as default country")):T.length>0&&(ve.set(T[0]),b(),console.log(`🌍 Selected ${T[0].name} as default country`))}else console.error("❌ Failed to load countries from IBF API:",A.error),z()}else console.log("🧪 Using mock data (IBF API disabled)"),z()}catch(A){console.error("❌ Error loading initial data:",A),z()}finally{We.set(!1)}}function z(){const A=[{countryCodeISO3:"ETH",countryName:"Ethiopia",name:"Ethiopia",region:"East Africa",coordinates:{lat:9.145,lng:40.4897},defaultZoom:6,population:114963588,countryBounds:[[3,33],[15,48]]},{countryCodeISO3:"PHL",countryName:"Philippines",name:"Philippines",region:"Southeast Asia",coordinates:{lat:12.8797,lng:121.774},defaultZoom:6,population:109581078,countryBounds:[[4.5,116],[21,127]]},{countryCodeISO3:"BGD",countryName:"Bangladesh",name:"Bangladesh",region:"South Asia",coordinates:{lat:23.685,lng:90.3563},defaultZoom:7,population:164689383,countryBounds:[[20.5,88],[26.5,93]]},{countryCodeISO3:"KEN",countryName:"Kenya",name:"Kenya",region:"East Africa",coordinates:{lat:-.0236,lng:37.9062},defaultZoom:6,population:53771296,countryBounds:[[-5,34],[5,42]]},{countryCodeISO3:"UGA",countryName:"Uganda",name:"Uganda",region:"East Africa",coordinates:{lat:1.3733,lng:32.2903},defaultZoom:7,population:45741007,countryBounds:[[-2,29.5],[4.5,35]]}];st.set(A),b();const T=A.find(F=>F.countryCodeISO3==="ETH");T?(ve.set(T),b()):A.length>0&&(ve.set(A[0]),b())}function j(A){const T=A.detail;console.log(`🌍 Country changed to: ${T.name}`),t(3,f=!1),ve.set(T),b(),window.updateMapCountry?(console.log(`🗺️ Triggering manual map update for: ${T.name}`),window.updateMapCountry(T)):console.log("⚠️ Map update method not available yet")}function S(A){console.log("🎯 Admin area hovered in App:",A.detail.area.properties.adm2_en),t(5,h=A.detail.area),t(6,v=A.detail.countryCode)}function D(){console.log("🔄 Admin area hover cleared in App"),t(5,h=null),t(6,v="")}function N(){t(3,f=!f),t(4,m=!1)}function Y(){t(4,m=!m),t(3,f=!1)}function W(){t(0,c=!0)}function Q(){Ve.logout(),b()}function G(){t(0,c=!1),b(),L()}function re(){t(0,c=!1)}function le(A){St.call(this,o,A)}function ge(A){St.call(this,o,A)}const H=A=>j({detail:A}),X=()=>t(3,f=!1),y=A=>A.key==="Escape"&&t(3,f=!1),M=()=>t(4,m=!1),P=A=>A.key==="Escape"&&t(4,m=!1);return o.$$.update=()=>{o.$$.dirty[0]&4194304&&t(11,n=s)},[c,l,u,f,m,h,v,_,$,g,k,n,a,j,S,D,N,Y,W,Q,G,re,s,le,ge,H,X,y,M,P]}class ko extends qe{constructor(e){super(),Ge(this,e,wo,vo,Me,{},null,[-1,-1])}}new ko({target:document.getElementById("app")});
