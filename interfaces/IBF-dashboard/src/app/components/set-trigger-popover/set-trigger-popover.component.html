<ion-card class="popover-window-card">
  <ion-card-header color="ibf-primary">
    <ion-icon
      name="close-circle"
      size="large"
      (click)="closePopover()"
      class="popover-close-button"
    ></ion-icon>
    @if (popoverStep === 'select-areas') {
      <ion-card-title>{{
        'set-trigger-component.select-areas.header' | translate
      }}</ion-card-title>
    } @else if (popoverStep === 'confirm') {
      <ion-card-title>{{
        'set-trigger-component.confirm.header' | translate
      }}</ion-card-title>
    }
  </ion-card-header>
  <ion-card-content class="ion-padding-top ion-text-center">
    @if (popoverStep === 'select-areas') {
      <ion-item lines="none" class="ion-margin-bottom">
        <span
          [innerHTML]="
            'set-trigger-component.select-areas.content'
              | translate
                : {
                    eventName: eventName,
                    forecastSourceLabel: forecastSource?.label || 'Unknown',
                    forecastSourceUrl: forecastSource?.url || '#',
                    adminAreaLabelPlural: adminAreaLabelPlural,
                  }
          "
        >
        </span>
      </ion-item>
      <ion-item lines="none">
        <ion-label class="text-xs">
          {{
            'set-trigger-component.select-areas.select-areas'
              | translate
                : {
                    adminAreaLabelPlural: adminAreaLabelPlural,
                  }
          }}
        </ion-label>
      </ion-item>
      <ion-list class="background-light">
        @for (area of areas; track area) {
          <ion-item lines="none" class="ion-no-padding">
            <ion-checkbox
              slot="start"
              color="ibf-primary"
              [(ngModel)]="selectedAreas[area.name]"
              name="selectedAreas[{{ area.name }}]"
            ></ion-checkbox>
            <ion-label class="ion-text-wrap text-xs"
              >{{ area.name }} ({{ area.placeCode }})
            </ion-label>
          </ion-item>
        }
      </ion-list>
      <ion-item lines="none" style="width: 100%">
        <div style="width: 100%" class="ion-text-end">
          <ion-button
            fill="clear"
            shape="round"
            color="ibf-trigger-alert-primary"
            (click)="closePopover()"
          >
            {{ 'set-trigger-component.select-areas.back' | translate }}
          </ion-button>
          <ion-button
            fill="solid"
            shape="round"
            color="ibf-trigger-alert-primary"
            [disabled]="isSubmitDisabled()"
            (click)="continueToConfirmStep()"
            >{{
              'set-trigger-component.select-areas.continue' | translate
            }}</ion-button
          >
        </div>
      </ion-item>
    } @else if (popoverStep === 'confirm') {
      <ion-item
        lines="none"
        class="ion-margin-bottom"
        [innerHTML]="
          'set-trigger-component.confirm.content'
            | translate
              : {
                  adminAreaLabelPlural: adminAreaLabelPlural,
                }
        "
      >
      </ion-item>
      <ion-item lines="none" class="ion-no-padding">
        <ion-checkbox
          slot="start"
          color="ibf-primary"
          [(ngModel)]="understood"
          name="understood"
        ></ion-checkbox>
        <ion-label class="ion-text-wrap"
          >{{ 'set-trigger-component.confirm.understand' | translate }}
        </ion-label>
      </ion-item>
      <ion-item lines="none" style="width: 100%">
        <div style="width: 100%" class="ion-text-end">
          <ion-button
            fill="clear"
            shape="round"
            color="ibf-trigger-alert-primary"
            (click)="backToSelectAreasStep()"
          >
            {{ 'set-trigger-component.confirm.back' | translate }}
          </ion-button>
          <ion-button
            fill="solid"
            shape="round"
            color="ibf-trigger-alert-primary"
            [disabled]="!understood"
            (click)="submitSetTriggerAreas()"
            >{{
              'set-trigger-component.confirm.continue' | translate
            }}</ion-button
          >
        </div>
      </ion-item>
    }
  </ion-card-content>
</ion-card>
