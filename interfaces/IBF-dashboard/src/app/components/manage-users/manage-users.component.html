<ion-grid class="m-8 max-w-7xl">
  <ion-row class="mb-6">
    <ion-col size="6">
      <ion-input
        [(ngModel)]="filterText"
        [disabled]="users.length === 0"
        fill="outline"
        [clearInput]="true"
        placeholder="Search..."
        style="--highlight-color-valid: var(--ion-color-ibf-grey-light)"
        data-testid="manage-users-search-input"
      >
      </ion-input>
    </ion-col>
    <ion-col size="6" class="flex items-center justify-end space-x-2">
      <ion-button
        fill="clear"
        size="large"
        color="medium"
        (mouseenter)="showManageUsersMenu($event)"
        data-testid="manage-users-menu-button"
      >
        <ion-icon slot="icon-only" name="menu"></ion-icon>
      </ion-button>
    </ion-col>
  </ion-row>
  <ion-row
    class="text-black text-opacity-40"
    data-testid="manage-users-table-headers"
  >
    @for (column of columns; track column.key) {
      @if (column.key !== 'countryCodesISO3' || userCountries.length > 1) {
        <ion-col
          (click)="setSort(column.key)"
          class="flex cursor-pointer items-center justify-start gap-2 indent-4"
          size="6"
          [sizeMd]="userCountries.length > 1 ? 3 : 4"
        >
          {{ column.label | translate }}
          <ion-icon [name]="getSortIcon(column.key)"></ion-icon>
        </ion-col>
      }
    }
  </ion-row>
  @if (pagedUsers.length === 0) {
    <ion-row>
      <ion-col class="flex h-40 items-center justify-center italic">
        {{ message }}
      </ion-col>
    </ion-row>
  } @else {
    @for (pagedUser of pagedUsers; track pagedUser.userId) {
      <ion-row class="items-center" [class.bg-gray-100]="$even">
        <ion-col size="6" [sizeMd]="userCountries.length > 1 ? 3 : 4">
          <ion-list [inset]="true" mode="ios" class="!m-2">
            <ion-item [color]="$even ? 'light' : 'ibf-white'" class="truncate">
              {{ getUserName(pagedUser) }}
            </ion-item>
          </ion-list>
        </ion-col>
        <ion-col size="6" [sizeMd]="userCountries.length > 1 ? 3 : 4">
          <ion-list [inset]="true" mode="ios" class="!m-2">
            <ion-item
              [button]="true"
              [detail]="true"
              detail-icon="mail"
              href="mailto:{{ pagedUser.email }}?subject=%5BIBF%5D%20"
              [title]="pagedUser.email"
              class="truncate"
            >
              {{ pagedUser.email }}
            </ion-item>
          </ion-list>
        </ion-col>
        <ion-col size="6" [sizeMd]="userCountries.length > 1 ? 3 : 4">
          <ion-list [inset]="true" mode="ios" class="!m-2">
            <ion-item
              [button]="true"
              (click)="showUserRoles($event, pagedUser)"
              [detail]="true"
              detail-icon="chevron-expand"
              [disabled]="!userRoles.includes(pagedUser.userRole)"
              class="truncate"
            >
              {{ USER_ROLE_LABEL[pagedUser.userRole] || pagedUser.userRole }}
            </ion-item>
          </ion-list>
        </ion-col>
        @if (userCountries.length > 1) {
          <ion-col size="6" size-md="3">
            <ion-list [inset]="true" mode="ios" class="!m-2">
              <ion-item
                [button]="true"
                (click)="showUserCountries($event, pagedUser)"
                [detail]="true"
                detail-icon="chevron-expand"
                [class.text-red-500]="pagedUser.countryCodesISO3.length === 0"
                class="truncate"
              >
                {{
                  'manage.users.countries-count'
                    | translate
                      : {
                          countryCount: pagedUser.countryCodesISO3.length,
                          countryLabel:
                            countryName[pagedUser.countryCodesISO3[0]] ||
                            pagedUser.countryCodesISO3[0],
                        }
                }}
              </ion-item>
            </ion-list>
          </ion-col>
        }
      </ion-row>
    }
  }
  <ion-row class="mt-6">
    @if (pagedUsers.length > 0) {
      <ion-col
        size="12"
        offset="0"
        offset-md="6"
        size-md="6"
        class="flex items-center justify-end space-x-2"
      >
        <ion-button
          color="medium"
          fill="clear"
          (click)="page = 1"
          [disabled]="page === 1"
        >
          <ion-icon slot="icon-only" name="caret-back"></ion-icon>
        </ion-button>
        <ion-button
          color="medium"
          fill="clear"
          (click)="page = page - 1"
          [disabled]="page === 1"
        >
          <ion-icon slot="icon-only" name="chevron-back"></ion-icon>
        </ion-button>
        <span>
          {{ (page - 1) * pageSize + 1 }} to
          {{ min(page * pageSize, sortedUsers.length) }} of
          {{ sortedUsers.length }}
        </span>
        <ion-button
          color="medium"
          fill="clear"
          (click)="page = page + 1"
          [disabled]="page === totalPages"
        >
          <ion-icon slot="icon-only" name="chevron-forward"></ion-icon>
        </ion-button>
        <ion-button
          color="medium"
          fill="clear"
          (click)="page = totalPages"
          [disabled]="page === totalPages"
        >
          <ion-icon slot="icon-only" name="caret-forward"></ion-icon>
        </ion-button>
      </ion-col>
    }
  </ion-row>
</ion-grid>
